full talloc report on 'msgb' (total      0 bytes in   1 blocks)
talloc_total_blocks(tall_bsc_ctx) == 13

===== test_reject_2nd_conn
- Location Update Request on one connection
  MSC <--GERAN-A-- MS: GSM48_MT_MM_LOC_UPD_REQUEST
  new conn
DMM RAN_conn{RAN_CONN_S_NEW}: Allocated
DREF unknown: MSC conn use + compl_l3 == 1 (0x1: compl_l3)
DRLL Dispatching 04.08 message GSM48_MT_MM_LOC_UPD_REQUEST (0x5:0x8)
DMM RAN_conn(GERAN-A-0_unknown_LU){RAN_CONN_S_NEW}: Updated ID
DMM LOCATION UPDATING REQUEST: MI(IMSI)=901700000004620 type=IMSI ATTACH
DMM LU/new-LAC: 1/23
DVLR vlr_lu_fsm(GERAN-A-0_unknown_LU){VLR_ULA_S_IDLE}: Allocated
DVLR vlr_lu_fsm(GERAN-A-0_unknown_LU){VLR_ULA_S_IDLE}: is child of RAN_conn(GERAN-A-0_unknown_LU)
DVLR vlr_lu_fsm(GERAN-A-0_unknown_LU){VLR_ULA_S_IDLE}: rev=GSM net=GERAN (no Auth)
DVLR vlr_lu_fsm(GERAN-A-0_unknown_LU){VLR_ULA_S_IDLE}: Received Event VLR_ULA_E_UPDATE_LA
DREF VLR subscr unknown usage increases to: 1
DVLR set IMSI on subscriber; IMSI=901700000004620 id=901700000004620
DVLR New subscr, IMSI: 901700000004620
DREF VLR subscr IMSI-901700000004620 usage increases to: 2
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_LU){RAN_CONN_S_NEW}: Updated ID
DREF VLR subscr IMSI-901700000004620 usage decreases to: 1
DVLR vlr_lu_fsm(GERAN-A-0_IMSI-901700000004620_LU){VLR_ULA_S_IDLE}: vlr_loc_upd_node1()
DVLR vlr_lu_fsm(GERAN-A-0_IMSI-901700000004620_LU){VLR_ULA_S_IDLE}: vlr_loc_upd_post_auth()
DVLR vlr_lu_fsm(GERAN-A-0_IMSI-901700000004620_LU){VLR_ULA_S_IDLE}: vlr_loc_upd_post_ciph()
DVLR vlr_lu_fsm(GERAN-A-0_IMSI-901700000004620_LU){VLR_ULA_S_IDLE}: vlr_loc_upd_node_4()
DVLR vlr_lu_fsm(GERAN-A-0_IMSI-901700000004620_LU){VLR_ULA_S_IDLE}: state_chg to VLR_ULA_S_WAIT_HLR_UPD
DVLR upd_hlr_vlr_fsm(GERAN-A-0_IMSI-901700000004620_LU){UPD_HLR_VLR_S_INIT}: Allocated
DVLR upd_hlr_vlr_fsm(GERAN-A-0_IMSI-901700000004620_LU){UPD_HLR_VLR_S_INIT}: is child of vlr_lu_fsm(GERAN-A-0_IMSI-901700000004620_LU)
DVLR upd_hlr_vlr_fsm(GERAN-A-0_IMSI-901700000004620_LU){UPD_HLR_VLR_S_INIT}: Received Event UPD_HLR_VLR_E_START
DVLR GSUP tx: 04010809710000004026f0280102290101
GSUP --> HLR: OSMO_GSUP_MSGT_UPDATE_LOCATION_REQUEST: 04010809710000004026f0280102290101
DVLR upd_hlr_vlr_fsm(GERAN-A-0_IMSI-901700000004620_LU){UPD_HLR_VLR_S_INIT}: state_chg to UPD_HLR_VLR_S_WAIT_FOR_DATA
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_LU){RAN_CONN_S_NEW}: Received Event RAN_CONN_E_COMPLETE_LAYER_3
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_LU){RAN_CONN_S_NEW}: state_chg to RAN_CONN_S_AUTH_CIPH
DREF IMSI-901700000004620: MSC conn use - compl_l3 == 0 (0x0: )
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_LU){RAN_CONN_S_AUTH_CIPH}: Received Event RAN_CONN_E_UNUSED
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_LU){RAN_CONN_S_AUTH_CIPH}: Awaiting results for Auth+Ciph, overruling event RAN_CONN_E_UNUSED
  lu_result_sent == 0
  llist_count(&net->ran_conns) == 1
- Another Location Update Request from the same subscriber on another connection is rejected
  MSC <--GERAN-A-- MS: GSM48_MT_MM_LOC_UPD_REQUEST
  new conn
DMM RAN_conn{RAN_CONN_S_NEW}: Allocated
DREF unknown: MSC conn use + compl_l3 == 1 (0x1: compl_l3)
DRLL Dispatching 04.08 message GSM48_MT_MM_LOC_UPD_REQUEST (0x5:0x8)
DMM RAN_conn(GERAN-A-0_unknown_LU){RAN_CONN_S_NEW}: Updated ID
DMM LOCATION UPDATING REQUEST: MI(IMSI)=901700000004620 type=IMSI ATTACH
DMM LU/new-LAC: 1/23
DVLR vlr_lu_fsm(GERAN-A-0_unknown_LU){VLR_ULA_S_IDLE}: Allocated
DVLR vlr_lu_fsm(GERAN-A-0_unknown_LU){VLR_ULA_S_IDLE}: is child of RAN_conn(GERAN-A-0_unknown_LU)
DVLR vlr_lu_fsm(GERAN-A-0_unknown_LU){VLR_ULA_S_IDLE}: rev=GSM net=GERAN (no Auth)
DVLR vlr_lu_fsm(GERAN-A-0_unknown_LU){VLR_ULA_S_IDLE}: Received Event VLR_ULA_E_UPDATE_LA
DREF VLR subscr IMSI-901700000004620 usage increases to: 2
DVLR vlr_lu_fsm(GERAN-A-0_unknown_LU){VLR_ULA_S_IDLE}: A Location Updating process is already pending for this subscriber. Aborting.
- sending LU Reject for unknown, cause 22
DVLR vlr_lu_fsm(GERAN-A-0_unknown_LU){VLR_ULA_S_IDLE}: state_chg to VLR_ULA_S_DONE
DMM RAN_conn(GERAN-A-0_unknown_LU){RAN_CONN_S_NEW}: Received Event RAN_CONN_E_CN_CLOSE
DMM RAN_conn(GERAN-A-0_unknown_LU){RAN_CONN_S_NEW}: state_chg to RAN_CONN_S_RELEASING
DREF unknown: MSC conn use + release == 2 (0x101: compl_l3,release)
- BSSAP Clear --GERAN-A--> MS
DREF VLR subscr IMSI-901700000004620 usage decreases to: 1
DRR 901700000004620: internal error during Location Updating attempt
DREF unknown: MSC conn use - compl_l3 == 1 (0x100: release)
  bssap_clear_sent == 1
  lu_result_sent == 2
- BSS sends BSSMAP Clear Complete
DREF unknown: MSC conn use - release == 0 (0x0: )
DMM RAN_conn(GERAN-A-0_unknown_LU){RAN_CONN_S_RELEASING}: Received Event RAN_CONN_E_UNUSED
DMM RAN_conn(GERAN-A-0_unknown_LU){RAN_CONN_S_RELEASING}: state_chg to RAN_CONN_S_RELEASED
DMM RAN_conn(GERAN-A-0_unknown_LU){RAN_CONN_S_RELEASED}: Terminating (cause = OSMO_FSM_TERM_REGULAR)
DVLR vlr_lu_fsm(GERAN-A-0_unknown_LU){VLR_ULA_S_DONE}: Terminating (cause = OSMO_FSM_TERM_PARENT)
DVLR vlr_lu_fsm(GERAN-A-0_unknown_LU){VLR_ULA_S_DONE}: Removing from parent RAN_conn(GERAN-A-0_unknown_LU)
DVLR vlr_lu_fsm(GERAN-A-0_unknown_LU){VLR_ULA_S_DONE}: fsm_lu_cleanup called with cause OSMO_FSM_TERM_PARENT
DVLR vlr_lu_fsm(GERAN-A-0_unknown_LU){VLR_ULA_S_DONE}: Freeing instance
DVLR vlr_lu_fsm(GERAN-A-0_unknown_LU){VLR_ULA_S_DONE}: Deallocated
DRLL Freeing RAN connection with NULL subscriber
DMM RAN_conn(GERAN-A-0_unknown_LU){RAN_CONN_S_RELEASED}: Freeing instance
DMM RAN_conn(GERAN-A-0_unknown_LU){RAN_CONN_S_RELEASED}: Deallocated
  llist_count(&net->ran_conns) == 1
---
- The first connection can still complete its LU
- HLR sends _INSERT_DATA_REQUEST, VLR responds with _INSERT_DATA_RESULT
<-- GSUP rx OSMO_GSUP_MSGT_INSERT_DATA_REQUEST: 10010809710000004026f00804036470f1
DVLR GSUP rx 17: 10010809710000004026f00804036470f1
DREF VLR subscr IMSI-901700000004620 usage increases to: 2
DVLR IMSI:901700000004620 has MSISDN:46071
DVLR SUBSCR(IMSI-901700000004620_MSISDN-46071) VLR: update for IMSI=901700000004620 (MSISDN=46071, used=2)
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){RAN_CONN_S_AUTH_CIPH}: Updated ID
DVLR GSUP tx: 12010809710000004026f0
GSUP --> HLR: OSMO_GSUP_MSGT_INSERT_DATA_RESULT: 12010809710000004026f0
DREF VLR subscr IMSI-901700000004620_MSISDN-46071 usage decreases to: 1
<-- GSUP rx OSMO_GSUP_MSGT_INSERT_DATA_REQUEST: vlr_gsupc_read_cb() returns 0
  lu_result_sent == 0
- HLR also sends GSUP _UPDATE_LOCATION_RESULT
<-- GSUP rx OSMO_GSUP_MSGT_UPDATE_LOCATION_RESULT: 06010809710000004026f0
DVLR GSUP rx 11: 06010809710000004026f0
DREF VLR subscr IMSI-901700000004620_MSISDN-46071 usage increases to: 2
DVLR vlr_lu_fsm(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){VLR_ULA_S_WAIT_HLR_UPD}: Received Event VLR_ULA_E_HLR_LU_RES
DVLR upd_hlr_vlr_fsm(GERAN-A-0_IMSI-901700000004620_LU){UPD_HLR_VLR_S_WAIT_FOR_DATA}: Received Event UPD_HLR_VLR_E_UPD_LOC_ACK
DVLR upd_hlr_vlr_fsm(GERAN-A-0_IMSI-901700000004620_LU){UPD_HLR_VLR_S_WAIT_FOR_DATA}: state_chg to UPD_HLR_VLR_S_DONE
DVLR upd_hlr_vlr_fsm(GERAN-A-0_IMSI-901700000004620_LU){UPD_HLR_VLR_S_DONE}: Terminating (cause = OSMO_FSM_TERM_REGULAR)
DVLR upd_hlr_vlr_fsm(GERAN-A-0_IMSI-901700000004620_LU){UPD_HLR_VLR_S_DONE}: Removing from parent vlr_lu_fsm(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU)
DVLR upd_hlr_vlr_fsm(GERAN-A-0_IMSI-901700000004620_LU){UPD_HLR_VLR_S_DONE}: Freeing instance
DVLR upd_hlr_vlr_fsm(GERAN-A-0_IMSI-901700000004620_LU){UPD_HLR_VLR_S_DONE}: Deallocated
DVLR vlr_lu_fsm(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){VLR_ULA_S_WAIT_HLR_UPD}: Received Event VLR_ULA_E_UPD_HLR_COMPL
DVLR vlr_lu_fsm(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){VLR_ULA_S_WAIT_HLR_UPD}: state_chg to VLR_ULA_S_WAIT_LU_COMPL
DVLR lu_compl_vlr_fsm(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){LU_COMPL_VLR_S_INIT}: Allocated
DVLR lu_compl_vlr_fsm(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){LU_COMPL_VLR_S_INIT}: is child of vlr_lu_fsm(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU)
DVLR lu_compl_vlr_fsm(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){LU_COMPL_VLR_S_INIT}: Received Event LU_COMPL_VLR_E_START
DVLR lu_compl_vlr_fsm(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){LU_COMPL_VLR_S_INIT}: state_chg to LU_COMPL_VLR_S_WAIT_SUB_PRES
DVLR lu_compl_vlr_fsm(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){LU_COMPL_VLR_S_WAIT_SUB_PRES}: Received Event LU_COMPL_VLR_E_SUB_PRES_COMPL
- sending LU Accept for IMSI-901700000004620_MSISDN-46071
DREF VLR subscr IMSI-901700000004620_MSISDN-46071 usage increases to: 3
DVLR lu_compl_vlr_fsm(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){LU_COMPL_VLR_S_WAIT_SUB_PRES}: state_chg to LU_COMPL_VLR_S_DONE
DVLR vlr_lu_fsm(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){VLR_ULA_S_WAIT_LU_COMPL}: Received Event VLR_ULA_E_LU_COMPL_SUCCESS
DVLR lu_compl_vlr_fsm(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){LU_COMPL_VLR_S_DONE}: Terminating (cause = OSMO_FSM_TERM_PARENT)
DVLR lu_compl_vlr_fsm(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){LU_COMPL_VLR_S_DONE}: Removing from parent vlr_lu_fsm(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU)
DVLR lu_compl_vlr_fsm(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){LU_COMPL_VLR_S_DONE}: Freeing instance
DVLR lu_compl_vlr_fsm(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){LU_COMPL_VLR_S_DONE}: Deallocated
DVLR vlr_lu_fsm(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){VLR_ULA_S_WAIT_LU_COMPL}: state_chg to VLR_ULA_S_DONE
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){RAN_CONN_S_AUTH_CIPH}: Received Event RAN_CONN_E_ACCEPTED
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){RAN_CONN_S_AUTH_CIPH}: state_chg to RAN_CONN_S_ACCEPTED
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){RAN_CONN_S_ACCEPTED}: Received Event RAN_CONN_E_UNUSED
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){RAN_CONN_S_ACCEPTED}: state_chg to RAN_CONN_S_RELEASING
DREF IMSI-901700000004620_MSISDN-46071: MSC conn use + release == 1 (0x100: release)
DREF VLR subscr IMSI-901700000004620_MSISDN-46071 usage increases to: 4
DREF VLR subscr IMSI-901700000004620_MSISDN-46071 usage decreases to: 3
- BSSAP Clear --GERAN-A--> MS
DREF VLR subscr IMSI-901700000004620_MSISDN-46071 usage decreases to: 2
<-- GSUP rx OSMO_GSUP_MSGT_UPDATE_LOCATION_RESULT: vlr_gsupc_read_cb() returns 0
  bssap_clear_sent == 1
- LU was successful, and the conn has already been closed
  lu_result_sent == 1
- BSS sends BSSMAP Clear Complete
DREF IMSI-901700000004620_MSISDN-46071: MSC conn use - release == 0 (0x0: )
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){RAN_CONN_S_RELEASING}: Received Event RAN_CONN_E_UNUSED
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){RAN_CONN_S_RELEASING}: state_chg to RAN_CONN_S_RELEASED
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){RAN_CONN_S_RELEASED}: Terminating (cause = OSMO_FSM_TERM_REGULAR)
DVLR vlr_lu_fsm(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){VLR_ULA_S_DONE}: Terminating (cause = OSMO_FSM_TERM_PARENT)
DVLR vlr_lu_fsm(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){VLR_ULA_S_DONE}: Removing from parent RAN_conn(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU)
DVLR vlr_lu_fsm(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){VLR_ULA_S_DONE}: fsm_lu_cleanup called with cause OSMO_FSM_TERM_PARENT
DVLR vlr_lu_fsm(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){VLR_ULA_S_DONE}: Freeing instance
DVLR vlr_lu_fsm(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){VLR_ULA_S_DONE}: Deallocated
DRLL IMSI-901700000004620_MSISDN-46071: Freeing RAN connection
DREF VLR subscr IMSI-901700000004620_MSISDN-46071 usage decreases to: 1
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){RAN_CONN_S_RELEASED}: Freeing instance
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){RAN_CONN_S_RELEASED}: Deallocated
  llist_count(&net->ran_conns) == 0
DREF freeing VLR subscr IMSI-901700000004620_MSISDN-46071
===== test_reject_2nd_conn: SUCCESS

full talloc report on 'msgb' (total      0 bytes in   1 blocks)
talloc_total_blocks(tall_bsc_ctx) == 13

===== test_reject_lu_during_lu
- Location Update Request
  MSC <--GERAN-A-- MS: GSM48_MT_MM_LOC_UPD_REQUEST
  new conn
DMM RAN_conn{RAN_CONN_S_NEW}: Allocated
DREF unknown: MSC conn use + compl_l3 == 1 (0x1: compl_l3)
DRLL Dispatching 04.08 message GSM48_MT_MM_LOC_UPD_REQUEST (0x5:0x8)
DMM RAN_conn(GERAN-A-0_unknown_LU){RAN_CONN_S_NEW}: Updated ID
DMM LOCATION UPDATING REQUEST: MI(IMSI)=901700000004620 type=IMSI ATTACH
DMM LU/new-LAC: 1/23
DVLR vlr_lu_fsm(GERAN-A-0_unknown_LU){VLR_ULA_S_IDLE}: Allocated
DVLR vlr_lu_fsm(GERAN-A-0_unknown_LU){VLR_ULA_S_IDLE}: is child of RAN_conn(GERAN-A-0_unknown_LU)
DVLR vlr_lu_fsm(GERAN-A-0_unknown_LU){VLR_ULA_S_IDLE}: rev=GSM net=GERAN (no Auth)
DVLR vlr_lu_fsm(GERAN-A-0_unknown_LU){VLR_ULA_S_IDLE}: Received Event VLR_ULA_E_UPDATE_LA
DREF VLR subscr unknown usage increases to: 1
DVLR set IMSI on subscriber; IMSI=901700000004620 id=901700000004620
DVLR New subscr, IMSI: 901700000004620
DREF VLR subscr IMSI-901700000004620 usage increases to: 2
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_LU){RAN_CONN_S_NEW}: Updated ID
DREF VLR subscr IMSI-901700000004620 usage decreases to: 1
DVLR vlr_lu_fsm(GERAN-A-0_IMSI-901700000004620_LU){VLR_ULA_S_IDLE}: vlr_loc_upd_node1()
DVLR vlr_lu_fsm(GERAN-A-0_IMSI-901700000004620_LU){VLR_ULA_S_IDLE}: vlr_loc_upd_post_auth()
DVLR vlr_lu_fsm(GERAN-A-0_IMSI-901700000004620_LU){VLR_ULA_S_IDLE}: vlr_loc_upd_post_ciph()
DVLR vlr_lu_fsm(GERAN-A-0_IMSI-901700000004620_LU){VLR_ULA_S_IDLE}: vlr_loc_upd_node_4()
DVLR vlr_lu_fsm(GERAN-A-0_IMSI-901700000004620_LU){VLR_ULA_S_IDLE}: state_chg to VLR_ULA_S_WAIT_HLR_UPD
DVLR upd_hlr_vlr_fsm(GERAN-A-0_IMSI-901700000004620_LU){UPD_HLR_VLR_S_INIT}: Allocated
DVLR upd_hlr_vlr_fsm(GERAN-A-0_IMSI-901700000004620_LU){UPD_HLR_VLR_S_INIT}: is child of vlr_lu_fsm(GERAN-A-0_IMSI-901700000004620_LU)
DVLR upd_hlr_vlr_fsm(GERAN-A-0_IMSI-901700000004620_LU){UPD_HLR_VLR_S_INIT}: Received Event UPD_HLR_VLR_E_START
DVLR GSUP tx: 04010809710000004026f0280102290101
GSUP --> HLR: OSMO_GSUP_MSGT_UPDATE_LOCATION_REQUEST: 04010809710000004026f0280102290101
DVLR upd_hlr_vlr_fsm(GERAN-A-0_IMSI-901700000004620_LU){UPD_HLR_VLR_S_INIT}: state_chg to UPD_HLR_VLR_S_WAIT_FOR_DATA
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_LU){RAN_CONN_S_NEW}: Received Event RAN_CONN_E_COMPLETE_LAYER_3
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_LU){RAN_CONN_S_NEW}: state_chg to RAN_CONN_S_AUTH_CIPH
DREF IMSI-901700000004620: MSC conn use - compl_l3 == 0 (0x0: )
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_LU){RAN_CONN_S_AUTH_CIPH}: Received Event RAN_CONN_E_UNUSED
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_LU){RAN_CONN_S_AUTH_CIPH}: Awaiting results for Auth+Ciph, overruling event RAN_CONN_E_UNUSED
  lu_result_sent == 0
  llist_count(&net->ran_conns) == 1
---
- Another Location Update Request from the same subscriber on the same conn is dropped silently
  MSC <--GERAN-A-- MS: GSM48_MT_MM_LOC_UPD_REQUEST
DREF IMSI-901700000004620: MSC conn use + dtap == 1 (0x2: dtap)
DRLL Dispatching 04.08 message GSM48_MT_MM_LOC_UPD_REQUEST (0x5:0x8)
DMM Cannot accept another LU, conn already busy establishing authenticity; extraneous LOCATION UPDATING REQUEST: MI(IMSI)=901700000004620 type=IMSI ATTACH
DREF IMSI-901700000004620: MSC conn use - dtap == 0 (0x0: )
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_LU){RAN_CONN_S_AUTH_CIPH}: Received Event RAN_CONN_E_UNUSED
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_LU){RAN_CONN_S_AUTH_CIPH}: Awaiting results for Auth+Ciph, overruling event RAN_CONN_E_UNUSED
  lu_result_sent == 0
  llist_count(&net->ran_conns) == 1
---
- The first LU can still complete
- HLR sends _INSERT_DATA_REQUEST, VLR responds with _INSERT_DATA_RESULT
<-- GSUP rx OSMO_GSUP_MSGT_INSERT_DATA_REQUEST: 10010809710000004026f00804036470f1
DVLR GSUP rx 17: 10010809710000004026f00804036470f1
DREF VLR subscr IMSI-901700000004620 usage increases to: 2
DVLR IMSI:901700000004620 has MSISDN:46071
DVLR SUBSCR(IMSI-901700000004620_MSISDN-46071) VLR: update for IMSI=901700000004620 (MSISDN=46071, used=2)
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){RAN_CONN_S_AUTH_CIPH}: Updated ID
DVLR GSUP tx: 12010809710000004026f0
GSUP --> HLR: OSMO_GSUP_MSGT_INSERT_DATA_RESULT: 12010809710000004026f0
DREF VLR subscr IMSI-901700000004620_MSISDN-46071 usage decreases to: 1
<-- GSUP rx OSMO_GSUP_MSGT_INSERT_DATA_REQUEST: vlr_gsupc_read_cb() returns 0
  lu_result_sent == 0
- HLR also sends GSUP _UPDATE_LOCATION_RESULT
<-- GSUP rx OSMO_GSUP_MSGT_UPDATE_LOCATION_RESULT: 06010809710000004026f0
DVLR GSUP rx 11: 06010809710000004026f0
DREF VLR subscr IMSI-901700000004620_MSISDN-46071 usage increases to: 2
DVLR vlr_lu_fsm(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){VLR_ULA_S_WAIT_HLR_UPD}: Received Event VLR_ULA_E_HLR_LU_RES
DVLR upd_hlr_vlr_fsm(GERAN-A-0_IMSI-901700000004620_LU){UPD_HLR_VLR_S_WAIT_FOR_DATA}: Received Event UPD_HLR_VLR_E_UPD_LOC_ACK
DVLR upd_hlr_vlr_fsm(GERAN-A-0_IMSI-901700000004620_LU){UPD_HLR_VLR_S_WAIT_FOR_DATA}: state_chg to UPD_HLR_VLR_S_DONE
DVLR upd_hlr_vlr_fsm(GERAN-A-0_IMSI-901700000004620_LU){UPD_HLR_VLR_S_DONE}: Terminating (cause = OSMO_FSM_TERM_REGULAR)
DVLR upd_hlr_vlr_fsm(GERAN-A-0_IMSI-901700000004620_LU){UPD_HLR_VLR_S_DONE}: Removing from parent vlr_lu_fsm(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU)
DVLR upd_hlr_vlr_fsm(GERAN-A-0_IMSI-901700000004620_LU){UPD_HLR_VLR_S_DONE}: Freeing instance
DVLR upd_hlr_vlr_fsm(GERAN-A-0_IMSI-901700000004620_LU){UPD_HLR_VLR_S_DONE}: Deallocated
DVLR vlr_lu_fsm(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){VLR_ULA_S_WAIT_HLR_UPD}: Received Event VLR_ULA_E_UPD_HLR_COMPL
DVLR vlr_lu_fsm(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){VLR_ULA_S_WAIT_HLR_UPD}: state_chg to VLR_ULA_S_WAIT_LU_COMPL
DVLR lu_compl_vlr_fsm(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){LU_COMPL_VLR_S_INIT}: Allocated
DVLR lu_compl_vlr_fsm(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){LU_COMPL_VLR_S_INIT}: is child of vlr_lu_fsm(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU)
DVLR lu_compl_vlr_fsm(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){LU_COMPL_VLR_S_INIT}: Received Event LU_COMPL_VLR_E_START
DVLR lu_compl_vlr_fsm(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){LU_COMPL_VLR_S_INIT}: state_chg to LU_COMPL_VLR_S_WAIT_SUB_PRES
DVLR lu_compl_vlr_fsm(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){LU_COMPL_VLR_S_WAIT_SUB_PRES}: Received Event LU_COMPL_VLR_E_SUB_PRES_COMPL
- sending LU Accept for IMSI-901700000004620_MSISDN-46071
DREF VLR subscr IMSI-901700000004620_MSISDN-46071 usage increases to: 3
DVLR lu_compl_vlr_fsm(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){LU_COMPL_VLR_S_WAIT_SUB_PRES}: state_chg to LU_COMPL_VLR_S_DONE
DVLR vlr_lu_fsm(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){VLR_ULA_S_WAIT_LU_COMPL}: Received Event VLR_ULA_E_LU_COMPL_SUCCESS
DVLR lu_compl_vlr_fsm(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){LU_COMPL_VLR_S_DONE}: Terminating (cause = OSMO_FSM_TERM_PARENT)
DVLR lu_compl_vlr_fsm(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){LU_COMPL_VLR_S_DONE}: Removing from parent vlr_lu_fsm(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU)
DVLR lu_compl_vlr_fsm(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){LU_COMPL_VLR_S_DONE}: Freeing instance
DVLR lu_compl_vlr_fsm(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){LU_COMPL_VLR_S_DONE}: Deallocated
DVLR vlr_lu_fsm(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){VLR_ULA_S_WAIT_LU_COMPL}: state_chg to VLR_ULA_S_DONE
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){RAN_CONN_S_AUTH_CIPH}: Received Event RAN_CONN_E_ACCEPTED
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){RAN_CONN_S_AUTH_CIPH}: state_chg to RAN_CONN_S_ACCEPTED
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){RAN_CONN_S_ACCEPTED}: Received Event RAN_CONN_E_UNUSED
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){RAN_CONN_S_ACCEPTED}: state_chg to RAN_CONN_S_RELEASING
DREF IMSI-901700000004620_MSISDN-46071: MSC conn use + release == 1 (0x100: release)
DREF VLR subscr IMSI-901700000004620_MSISDN-46071 usage increases to: 4
DREF VLR subscr IMSI-901700000004620_MSISDN-46071 usage decreases to: 3
- BSSAP Clear --GERAN-A--> MS
DREF VLR subscr IMSI-901700000004620_MSISDN-46071 usage decreases to: 2
<-- GSUP rx OSMO_GSUP_MSGT_UPDATE_LOCATION_RESULT: vlr_gsupc_read_cb() returns 0
  bssap_clear_sent == 1
- LU was successful, and the conn has already been closed
  lu_result_sent == 1
- BSS sends BSSMAP Clear Complete
DREF IMSI-901700000004620_MSISDN-46071: MSC conn use - release == 0 (0x0: )
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){RAN_CONN_S_RELEASING}: Received Event RAN_CONN_E_UNUSED
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){RAN_CONN_S_RELEASING}: state_chg to RAN_CONN_S_RELEASED
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){RAN_CONN_S_RELEASED}: Terminating (cause = OSMO_FSM_TERM_REGULAR)
DVLR vlr_lu_fsm(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){VLR_ULA_S_DONE}: Terminating (cause = OSMO_FSM_TERM_PARENT)
DVLR vlr_lu_fsm(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){VLR_ULA_S_DONE}: Removing from parent RAN_conn(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU)
DVLR vlr_lu_fsm(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){VLR_ULA_S_DONE}: fsm_lu_cleanup called with cause OSMO_FSM_TERM_PARENT
DVLR vlr_lu_fsm(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){VLR_ULA_S_DONE}: Freeing instance
DVLR vlr_lu_fsm(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){VLR_ULA_S_DONE}: Deallocated
DRLL IMSI-901700000004620_MSISDN-46071: Freeing RAN connection
DREF VLR subscr IMSI-901700000004620_MSISDN-46071 usage decreases to: 1
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){RAN_CONN_S_RELEASED}: Freeing instance
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){RAN_CONN_S_RELEASED}: Deallocated
  llist_count(&net->ran_conns) == 0
DREF freeing VLR subscr IMSI-901700000004620_MSISDN-46071
===== test_reject_lu_during_lu: SUCCESS

full talloc report on 'msgb' (total      0 bytes in   1 blocks)
talloc_total_blocks(tall_bsc_ctx) == 13

===== test_reject_cm_during_lu
- Location Update Request
  MSC <--GERAN-A-- MS: GSM48_MT_MM_LOC_UPD_REQUEST
  new conn
DMM RAN_conn{RAN_CONN_S_NEW}: Allocated
DREF unknown: MSC conn use + compl_l3 == 1 (0x1: compl_l3)
DRLL Dispatching 04.08 message GSM48_MT_MM_LOC_UPD_REQUEST (0x5:0x8)
DMM RAN_conn(GERAN-A-0_unknown_LU){RAN_CONN_S_NEW}: Updated ID
DMM LOCATION UPDATING REQUEST: MI(IMSI)=901700000004620 type=IMSI ATTACH
DMM LU/new-LAC: 1/23
DVLR vlr_lu_fsm(GERAN-A-0_unknown_LU){VLR_ULA_S_IDLE}: Allocated
DVLR vlr_lu_fsm(GERAN-A-0_unknown_LU){VLR_ULA_S_IDLE}: is child of RAN_conn(GERAN-A-0_unknown_LU)
DVLR vlr_lu_fsm(GERAN-A-0_unknown_LU){VLR_ULA_S_IDLE}: rev=GSM net=GERAN (no Auth)
DVLR vlr_lu_fsm(GERAN-A-0_unknown_LU){VLR_ULA_S_IDLE}: Received Event VLR_ULA_E_UPDATE_LA
DREF VLR subscr unknown usage increases to: 1
DVLR set IMSI on subscriber; IMSI=901700000004620 id=901700000004620
DVLR New subscr, IMSI: 901700000004620
DREF VLR subscr IMSI-901700000004620 usage increases to: 2
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_LU){RAN_CONN_S_NEW}: Updated ID
DREF VLR subscr IMSI-901700000004620 usage decreases to: 1
DVLR vlr_lu_fsm(GERAN-A-0_IMSI-901700000004620_LU){VLR_ULA_S_IDLE}: vlr_loc_upd_node1()
DVLR vlr_lu_fsm(GERAN-A-0_IMSI-901700000004620_LU){VLR_ULA_S_IDLE}: vlr_loc_upd_post_auth()
DVLR vlr_lu_fsm(GERAN-A-0_IMSI-901700000004620_LU){VLR_ULA_S_IDLE}: vlr_loc_upd_post_ciph()
DVLR vlr_lu_fsm(GERAN-A-0_IMSI-901700000004620_LU){VLR_ULA_S_IDLE}: vlr_loc_upd_node_4()
DVLR vlr_lu_fsm(GERAN-A-0_IMSI-901700000004620_LU){VLR_ULA_S_IDLE}: state_chg to VLR_ULA_S_WAIT_HLR_UPD
DVLR upd_hlr_vlr_fsm(GERAN-A-0_IMSI-901700000004620_LU){UPD_HLR_VLR_S_INIT}: Allocated
DVLR upd_hlr_vlr_fsm(GERAN-A-0_IMSI-901700000004620_LU){UPD_HLR_VLR_S_INIT}: is child of vlr_lu_fsm(GERAN-A-0_IMSI-901700000004620_LU)
DVLR upd_hlr_vlr_fsm(GERAN-A-0_IMSI-901700000004620_LU){UPD_HLR_VLR_S_INIT}: Received Event UPD_HLR_VLR_E_START
DVLR GSUP tx: 04010809710000004026f0280102290101
GSUP --> HLR: OSMO_GSUP_MSGT_UPDATE_LOCATION_REQUEST: 04010809710000004026f0280102290101
DVLR upd_hlr_vlr_fsm(GERAN-A-0_IMSI-901700000004620_LU){UPD_HLR_VLR_S_INIT}: state_chg to UPD_HLR_VLR_S_WAIT_FOR_DATA
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_LU){RAN_CONN_S_NEW}: Received Event RAN_CONN_E_COMPLETE_LAYER_3
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_LU){RAN_CONN_S_NEW}: state_chg to RAN_CONN_S_AUTH_CIPH
DREF IMSI-901700000004620: MSC conn use - compl_l3 == 0 (0x0: )
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_LU){RAN_CONN_S_AUTH_CIPH}: Received Event RAN_CONN_E_UNUSED
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_LU){RAN_CONN_S_AUTH_CIPH}: Awaiting results for Auth+Ciph, overruling event RAN_CONN_E_UNUSED
  lu_result_sent == 0
  llist_count(&net->ran_conns) == 1
---
- A CM Service Request in the middle of a LU is rejected
  MSC <--GERAN-A-- MS: GSM48_MT_MM_CM_SERV_REQ
DREF IMSI-901700000004620: MSC conn use + dtap == 1 (0x2: dtap)
DRLL Dispatching 04.08 message GSM48_MT_MM_CM_SERV_REQ (0x5:0x24)
DMM <- CM SERVICE REQUEST serv_type=0x08 MI(IMSI)=901700000004620
DMM Cannot accept CM Service Request, conn already busy establishing authenticity
DMM -> CM SERVICE Reject cause: 22
DMSC msc_tx 3 bytes to IMSI-901700000004620 via GERAN-A
- DTAP --GERAN-A--> MS: GSM48_MT_MM_CM_SERV_REJ: 052216
- DTAP matches expected message
DREF IMSI-901700000004620: MSC conn use - dtap == 0 (0x0: )
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_LU){RAN_CONN_S_AUTH_CIPH}: Received Event RAN_CONN_E_UNUSED
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_LU){RAN_CONN_S_AUTH_CIPH}: Awaiting results for Auth+Ciph, overruling event RAN_CONN_E_UNUSED
  lu_result_sent == 0
  cm_service_result_sent == 0
  dtap_tx_confirmed == 1
  llist_count(&net->ran_conns) == 1
---
- The first LU can still complete
- HLR sends _INSERT_DATA_REQUEST, VLR responds with _INSERT_DATA_RESULT
<-- GSUP rx OSMO_GSUP_MSGT_INSERT_DATA_REQUEST: 10010809710000004026f00804036470f1
DVLR GSUP rx 17: 10010809710000004026f00804036470f1
DREF VLR subscr IMSI-901700000004620 usage increases to: 2
DVLR IMSI:901700000004620 has MSISDN:46071
DVLR SUBSCR(IMSI-901700000004620_MSISDN-46071) VLR: update for IMSI=901700000004620 (MSISDN=46071, used=2)
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){RAN_CONN_S_AUTH_CIPH}: Updated ID
DVLR GSUP tx: 12010809710000004026f0
GSUP --> HLR: OSMO_GSUP_MSGT_INSERT_DATA_RESULT: 12010809710000004026f0
DREF VLR subscr IMSI-901700000004620_MSISDN-46071 usage decreases to: 1
<-- GSUP rx OSMO_GSUP_MSGT_INSERT_DATA_REQUEST: vlr_gsupc_read_cb() returns 0
  lu_result_sent == 0
- HLR also sends GSUP _UPDATE_LOCATION_RESULT
<-- GSUP rx OSMO_GSUP_MSGT_UPDATE_LOCATION_RESULT: 06010809710000004026f0
DVLR GSUP rx 11: 06010809710000004026f0
DREF VLR subscr IMSI-901700000004620_MSISDN-46071 usage increases to: 2
DVLR vlr_lu_fsm(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){VLR_ULA_S_WAIT_HLR_UPD}: Received Event VLR_ULA_E_HLR_LU_RES
DVLR upd_hlr_vlr_fsm(GERAN-A-0_IMSI-901700000004620_LU){UPD_HLR_VLR_S_WAIT_FOR_DATA}: Received Event UPD_HLR_VLR_E_UPD_LOC_ACK
DVLR upd_hlr_vlr_fsm(GERAN-A-0_IMSI-901700000004620_LU){UPD_HLR_VLR_S_WAIT_FOR_DATA}: state_chg to UPD_HLR_VLR_S_DONE
DVLR upd_hlr_vlr_fsm(GERAN-A-0_IMSI-901700000004620_LU){UPD_HLR_VLR_S_DONE}: Terminating (cause = OSMO_FSM_TERM_REGULAR)
DVLR upd_hlr_vlr_fsm(GERAN-A-0_IMSI-901700000004620_LU){UPD_HLR_VLR_S_DONE}: Removing from parent vlr_lu_fsm(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU)
DVLR upd_hlr_vlr_fsm(GERAN-A-0_IMSI-901700000004620_LU){UPD_HLR_VLR_S_DONE}: Freeing instance
DVLR upd_hlr_vlr_fsm(GERAN-A-0_IMSI-901700000004620_LU){UPD_HLR_VLR_S_DONE}: Deallocated
DVLR vlr_lu_fsm(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){VLR_ULA_S_WAIT_HLR_UPD}: Received Event VLR_ULA_E_UPD_HLR_COMPL
DVLR vlr_lu_fsm(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){VLR_ULA_S_WAIT_HLR_UPD}: state_chg to VLR_ULA_S_WAIT_LU_COMPL
DVLR lu_compl_vlr_fsm(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){LU_COMPL_VLR_S_INIT}: Allocated
DVLR lu_compl_vlr_fsm(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){LU_COMPL_VLR_S_INIT}: is child of vlr_lu_fsm(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU)
DVLR lu_compl_vlr_fsm(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){LU_COMPL_VLR_S_INIT}: Received Event LU_COMPL_VLR_E_START
DVLR lu_compl_vlr_fsm(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){LU_COMPL_VLR_S_INIT}: state_chg to LU_COMPL_VLR_S_WAIT_SUB_PRES
DVLR lu_compl_vlr_fsm(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){LU_COMPL_VLR_S_WAIT_SUB_PRES}: Received Event LU_COMPL_VLR_E_SUB_PRES_COMPL
- sending LU Accept for IMSI-901700000004620_MSISDN-46071
DREF VLR subscr IMSI-901700000004620_MSISDN-46071 usage increases to: 3
DVLR lu_compl_vlr_fsm(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){LU_COMPL_VLR_S_WAIT_SUB_PRES}: state_chg to LU_COMPL_VLR_S_DONE
DVLR vlr_lu_fsm(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){VLR_ULA_S_WAIT_LU_COMPL}: Received Event VLR_ULA_E_LU_COMPL_SUCCESS
DVLR lu_compl_vlr_fsm(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){LU_COMPL_VLR_S_DONE}: Terminating (cause = OSMO_FSM_TERM_PARENT)
DVLR lu_compl_vlr_fsm(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){LU_COMPL_VLR_S_DONE}: Removing from parent vlr_lu_fsm(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU)
DVLR lu_compl_vlr_fsm(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){LU_COMPL_VLR_S_DONE}: Freeing instance
DVLR lu_compl_vlr_fsm(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){LU_COMPL_VLR_S_DONE}: Deallocated
DVLR vlr_lu_fsm(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){VLR_ULA_S_WAIT_LU_COMPL}: state_chg to VLR_ULA_S_DONE
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){RAN_CONN_S_AUTH_CIPH}: Received Event RAN_CONN_E_ACCEPTED
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){RAN_CONN_S_AUTH_CIPH}: state_chg to RAN_CONN_S_ACCEPTED
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){RAN_CONN_S_ACCEPTED}: Received Event RAN_CONN_E_UNUSED
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){RAN_CONN_S_ACCEPTED}: state_chg to RAN_CONN_S_RELEASING
DREF IMSI-901700000004620_MSISDN-46071: MSC conn use + release == 1 (0x100: release)
DREF VLR subscr IMSI-901700000004620_MSISDN-46071 usage increases to: 4
DREF VLR subscr IMSI-901700000004620_MSISDN-46071 usage decreases to: 3
- BSSAP Clear --GERAN-A--> MS
DREF VLR subscr IMSI-901700000004620_MSISDN-46071 usage decreases to: 2
<-- GSUP rx OSMO_GSUP_MSGT_UPDATE_LOCATION_RESULT: vlr_gsupc_read_cb() returns 0
  bssap_clear_sent == 1
- LU was successful, and the conn has already been closed
  lu_result_sent == 1
- BSS sends BSSMAP Clear Complete
DREF IMSI-901700000004620_MSISDN-46071: MSC conn use - release == 0 (0x0: )
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){RAN_CONN_S_RELEASING}: Received Event RAN_CONN_E_UNUSED
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){RAN_CONN_S_RELEASING}: state_chg to RAN_CONN_S_RELEASED
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){RAN_CONN_S_RELEASED}: Terminating (cause = OSMO_FSM_TERM_REGULAR)
DVLR vlr_lu_fsm(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){VLR_ULA_S_DONE}: Terminating (cause = OSMO_FSM_TERM_PARENT)
DVLR vlr_lu_fsm(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){VLR_ULA_S_DONE}: Removing from parent RAN_conn(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU)
DVLR vlr_lu_fsm(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){VLR_ULA_S_DONE}: fsm_lu_cleanup called with cause OSMO_FSM_TERM_PARENT
DVLR vlr_lu_fsm(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){VLR_ULA_S_DONE}: Freeing instance
DVLR vlr_lu_fsm(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){VLR_ULA_S_DONE}: Deallocated
DRLL IMSI-901700000004620_MSISDN-46071: Freeing RAN connection
DREF VLR subscr IMSI-901700000004620_MSISDN-46071 usage decreases to: 1
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){RAN_CONN_S_RELEASED}: Freeing instance
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){RAN_CONN_S_RELEASED}: Deallocated
  llist_count(&net->ran_conns) == 0
DREF freeing VLR subscr IMSI-901700000004620_MSISDN-46071
===== test_reject_cm_during_lu: SUCCESS

full talloc report on 'msgb' (total      0 bytes in   1 blocks)
talloc_total_blocks(tall_bsc_ctx) == 13

===== test_reject_paging_resp_during_lu
- Location Update Request
  MSC <--GERAN-A-- MS: GSM48_MT_MM_LOC_UPD_REQUEST
  new conn
DMM RAN_conn{RAN_CONN_S_NEW}: Allocated
DREF unknown: MSC conn use + compl_l3 == 1 (0x1: compl_l3)
DRLL Dispatching 04.08 message GSM48_MT_MM_LOC_UPD_REQUEST (0x5:0x8)
DMM RAN_conn(GERAN-A-0_unknown_LU){RAN_CONN_S_NEW}: Updated ID
DMM LOCATION UPDATING REQUEST: MI(IMSI)=901700000004620 type=IMSI ATTACH
DMM LU/new-LAC: 1/23
DVLR vlr_lu_fsm(GERAN-A-0_unknown_LU){VLR_ULA_S_IDLE}: Allocated
DVLR vlr_lu_fsm(GERAN-A-0_unknown_LU){VLR_ULA_S_IDLE}: is child of RAN_conn(GERAN-A-0_unknown_LU)
DVLR vlr_lu_fsm(GERAN-A-0_unknown_LU){VLR_ULA_S_IDLE}: rev=GSM net=GERAN (no Auth)
DVLR vlr_lu_fsm(GERAN-A-0_unknown_LU){VLR_ULA_S_IDLE}: Received Event VLR_ULA_E_UPDATE_LA
DREF VLR subscr unknown usage increases to: 1
DVLR set IMSI on subscriber; IMSI=901700000004620 id=901700000004620
DVLR New subscr, IMSI: 901700000004620
DREF VLR subscr IMSI-901700000004620 usage increases to: 2
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_LU){RAN_CONN_S_NEW}: Updated ID
DREF VLR subscr IMSI-901700000004620 usage decreases to: 1
DVLR vlr_lu_fsm(GERAN-A-0_IMSI-901700000004620_LU){VLR_ULA_S_IDLE}: vlr_loc_upd_node1()
DVLR vlr_lu_fsm(GERAN-A-0_IMSI-901700000004620_LU){VLR_ULA_S_IDLE}: vlr_loc_upd_post_auth()
DVLR vlr_lu_fsm(GERAN-A-0_IMSI-901700000004620_LU){VLR_ULA_S_IDLE}: vlr_loc_upd_post_ciph()
DVLR vlr_lu_fsm(GERAN-A-0_IMSI-901700000004620_LU){VLR_ULA_S_IDLE}: vlr_loc_upd_node_4()
DVLR vlr_lu_fsm(GERAN-A-0_IMSI-901700000004620_LU){VLR_ULA_S_IDLE}: state_chg to VLR_ULA_S_WAIT_HLR_UPD
DVLR upd_hlr_vlr_fsm(GERAN-A-0_IMSI-901700000004620_LU){UPD_HLR_VLR_S_INIT}: Allocated
DVLR upd_hlr_vlr_fsm(GERAN-A-0_IMSI-901700000004620_LU){UPD_HLR_VLR_S_INIT}: is child of vlr_lu_fsm(GERAN-A-0_IMSI-901700000004620_LU)
DVLR upd_hlr_vlr_fsm(GERAN-A-0_IMSI-901700000004620_LU){UPD_HLR_VLR_S_INIT}: Received Event UPD_HLR_VLR_E_START
DVLR GSUP tx: 04010809710000004026f0280102290101
GSUP --> HLR: OSMO_GSUP_MSGT_UPDATE_LOCATION_REQUEST: 04010809710000004026f0280102290101
DVLR upd_hlr_vlr_fsm(GERAN-A-0_IMSI-901700000004620_LU){UPD_HLR_VLR_S_INIT}: state_chg to UPD_HLR_VLR_S_WAIT_FOR_DATA
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_LU){RAN_CONN_S_NEW}: Received Event RAN_CONN_E_COMPLETE_LAYER_3
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_LU){RAN_CONN_S_NEW}: state_chg to RAN_CONN_S_AUTH_CIPH
DREF IMSI-901700000004620: MSC conn use - compl_l3 == 0 (0x0: )
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_LU){RAN_CONN_S_AUTH_CIPH}: Received Event RAN_CONN_E_UNUSED
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_LU){RAN_CONN_S_AUTH_CIPH}: Awaiting results for Auth+Ciph, overruling event RAN_CONN_E_UNUSED
  lu_result_sent == 0
  llist_count(&net->ran_conns) == 1
---
- An erratic Paging Response is dropped silently
  MSC <--GERAN-A-- MS: GSM48_MT_RR_PAG_RESP
DREF IMSI-901700000004620: MSC conn use + dtap == 1 (0x2: dtap)
DRLL Dispatching 04.08 message GSM48_MT_RR_PAG_RESP (0x6:0x27)
DMM Ignoring Paging Response, conn already busy establishing authenticity
DREF IMSI-901700000004620: MSC conn use - dtap == 0 (0x0: )
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_LU){RAN_CONN_S_AUTH_CIPH}: Received Event RAN_CONN_E_UNUSED
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_LU){RAN_CONN_S_AUTH_CIPH}: Awaiting results for Auth+Ciph, overruling event RAN_CONN_E_UNUSED
  lu_result_sent == 0
  llist_count(&net->ran_conns) == 1
---
- The first LU can still complete
- HLR sends _INSERT_DATA_REQUEST, VLR responds with _INSERT_DATA_RESULT
<-- GSUP rx OSMO_GSUP_MSGT_INSERT_DATA_REQUEST: 10010809710000004026f00804036470f1
DVLR GSUP rx 17: 10010809710000004026f00804036470f1
DREF VLR subscr IMSI-901700000004620 usage increases to: 2
DVLR IMSI:901700000004620 has MSISDN:46071
DVLR SUBSCR(IMSI-901700000004620_MSISDN-46071) VLR: update for IMSI=901700000004620 (MSISDN=46071, used=2)
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){RAN_CONN_S_AUTH_CIPH}: Updated ID
DVLR GSUP tx: 12010809710000004026f0
GSUP --> HLR: OSMO_GSUP_MSGT_INSERT_DATA_RESULT: 12010809710000004026f0
DREF VLR subscr IMSI-901700000004620_MSISDN-46071 usage decreases to: 1
<-- GSUP rx OSMO_GSUP_MSGT_INSERT_DATA_REQUEST: vlr_gsupc_read_cb() returns 0
  lu_result_sent == 0
- HLR also sends GSUP _UPDATE_LOCATION_RESULT
<-- GSUP rx OSMO_GSUP_MSGT_UPDATE_LOCATION_RESULT: 06010809710000004026f0
DVLR GSUP rx 11: 06010809710000004026f0
DREF VLR subscr IMSI-901700000004620_MSISDN-46071 usage increases to: 2
DVLR vlr_lu_fsm(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){VLR_ULA_S_WAIT_HLR_UPD}: Received Event VLR_ULA_E_HLR_LU_RES
DVLR upd_hlr_vlr_fsm(GERAN-A-0_IMSI-901700000004620_LU){UPD_HLR_VLR_S_WAIT_FOR_DATA}: Received Event UPD_HLR_VLR_E_UPD_LOC_ACK
DVLR upd_hlr_vlr_fsm(GERAN-A-0_IMSI-901700000004620_LU){UPD_HLR_VLR_S_WAIT_FOR_DATA}: state_chg to UPD_HLR_VLR_S_DONE
DVLR upd_hlr_vlr_fsm(GERAN-A-0_IMSI-901700000004620_LU){UPD_HLR_VLR_S_DONE}: Terminating (cause = OSMO_FSM_TERM_REGULAR)
DVLR upd_hlr_vlr_fsm(GERAN-A-0_IMSI-901700000004620_LU){UPD_HLR_VLR_S_DONE}: Removing from parent vlr_lu_fsm(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU)
DVLR upd_hlr_vlr_fsm(GERAN-A-0_IMSI-901700000004620_LU){UPD_HLR_VLR_S_DONE}: Freeing instance
DVLR upd_hlr_vlr_fsm(GERAN-A-0_IMSI-901700000004620_LU){UPD_HLR_VLR_S_DONE}: Deallocated
DVLR vlr_lu_fsm(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){VLR_ULA_S_WAIT_HLR_UPD}: Received Event VLR_ULA_E_UPD_HLR_COMPL
DVLR vlr_lu_fsm(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){VLR_ULA_S_WAIT_HLR_UPD}: state_chg to VLR_ULA_S_WAIT_LU_COMPL
DVLR lu_compl_vlr_fsm(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){LU_COMPL_VLR_S_INIT}: Allocated
DVLR lu_compl_vlr_fsm(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){LU_COMPL_VLR_S_INIT}: is child of vlr_lu_fsm(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU)
DVLR lu_compl_vlr_fsm(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){LU_COMPL_VLR_S_INIT}: Received Event LU_COMPL_VLR_E_START
DVLR lu_compl_vlr_fsm(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){LU_COMPL_VLR_S_INIT}: state_chg to LU_COMPL_VLR_S_WAIT_SUB_PRES
DVLR lu_compl_vlr_fsm(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){LU_COMPL_VLR_S_WAIT_SUB_PRES}: Received Event LU_COMPL_VLR_E_SUB_PRES_COMPL
- sending LU Accept for IMSI-901700000004620_MSISDN-46071
DREF VLR subscr IMSI-901700000004620_MSISDN-46071 usage increases to: 3
DVLR lu_compl_vlr_fsm(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){LU_COMPL_VLR_S_WAIT_SUB_PRES}: state_chg to LU_COMPL_VLR_S_DONE
DVLR vlr_lu_fsm(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){VLR_ULA_S_WAIT_LU_COMPL}: Received Event VLR_ULA_E_LU_COMPL_SUCCESS
DVLR lu_compl_vlr_fsm(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){LU_COMPL_VLR_S_DONE}: Terminating (cause = OSMO_FSM_TERM_PARENT)
DVLR lu_compl_vlr_fsm(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){LU_COMPL_VLR_S_DONE}: Removing from parent vlr_lu_fsm(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU)
DVLR lu_compl_vlr_fsm(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){LU_COMPL_VLR_S_DONE}: Freeing instance
DVLR lu_compl_vlr_fsm(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){LU_COMPL_VLR_S_DONE}: Deallocated
DVLR vlr_lu_fsm(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){VLR_ULA_S_WAIT_LU_COMPL}: state_chg to VLR_ULA_S_DONE
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){RAN_CONN_S_AUTH_CIPH}: Received Event RAN_CONN_E_ACCEPTED
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){RAN_CONN_S_AUTH_CIPH}: state_chg to RAN_CONN_S_ACCEPTED
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){RAN_CONN_S_ACCEPTED}: Received Event RAN_CONN_E_UNUSED
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){RAN_CONN_S_ACCEPTED}: state_chg to RAN_CONN_S_RELEASING
DREF IMSI-901700000004620_MSISDN-46071: MSC conn use + release == 1 (0x100: release)
DREF VLR subscr IMSI-901700000004620_MSISDN-46071 usage increases to: 4
DREF VLR subscr IMSI-901700000004620_MSISDN-46071 usage decreases to: 3
- BSSAP Clear --GERAN-A--> MS
DREF VLR subscr IMSI-901700000004620_MSISDN-46071 usage decreases to: 2
<-- GSUP rx OSMO_GSUP_MSGT_UPDATE_LOCATION_RESULT: vlr_gsupc_read_cb() returns 0
  bssap_clear_sent == 1
- LU was successful, and the conn has already been closed
  lu_result_sent == 1
- BSS sends BSSMAP Clear Complete
DREF IMSI-901700000004620_MSISDN-46071: MSC conn use - release == 0 (0x0: )
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){RAN_CONN_S_RELEASING}: Received Event RAN_CONN_E_UNUSED
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){RAN_CONN_S_RELEASING}: state_chg to RAN_CONN_S_RELEASED
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){RAN_CONN_S_RELEASED}: Terminating (cause = OSMO_FSM_TERM_REGULAR)
DVLR vlr_lu_fsm(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){VLR_ULA_S_DONE}: Terminating (cause = OSMO_FSM_TERM_PARENT)
DVLR vlr_lu_fsm(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){VLR_ULA_S_DONE}: Removing from parent RAN_conn(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU)
DVLR vlr_lu_fsm(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){VLR_ULA_S_DONE}: fsm_lu_cleanup called with cause OSMO_FSM_TERM_PARENT
DVLR vlr_lu_fsm(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){VLR_ULA_S_DONE}: Freeing instance
DVLR vlr_lu_fsm(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){VLR_ULA_S_DONE}: Deallocated
DRLL IMSI-901700000004620_MSISDN-46071: Freeing RAN connection
DREF VLR subscr IMSI-901700000004620_MSISDN-46071 usage decreases to: 1
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){RAN_CONN_S_RELEASED}: Freeing instance
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){RAN_CONN_S_RELEASED}: Deallocated
  llist_count(&net->ran_conns) == 0
DREF freeing VLR subscr IMSI-901700000004620_MSISDN-46071
===== test_reject_paging_resp_during_lu: SUCCESS

full talloc report on 'msgb' (total      0 bytes in   1 blocks)
talloc_total_blocks(tall_bsc_ctx) == 13

===== test_reject_lu_during_cm
---
- Subscriber does a normal LU
- Location Update Request
  MSC <--GERAN-A-- MS: GSM48_MT_MM_LOC_UPD_REQUEST
  new conn
DMM RAN_conn{RAN_CONN_S_NEW}: Allocated
DREF unknown: MSC conn use + compl_l3 == 1 (0x1: compl_l3)
DRLL Dispatching 04.08 message GSM48_MT_MM_LOC_UPD_REQUEST (0x5:0x8)
DMM RAN_conn(GERAN-A-0_unknown_LU){RAN_CONN_S_NEW}: Updated ID
DMM LOCATION UPDATING REQUEST: MI(IMSI)=901700000004620 type=IMSI ATTACH
DMM LU/new-LAC: 1/23
DVLR vlr_lu_fsm(GERAN-A-0_unknown_LU){VLR_ULA_S_IDLE}: Allocated
DVLR vlr_lu_fsm(GERAN-A-0_unknown_LU){VLR_ULA_S_IDLE}: is child of RAN_conn(GERAN-A-0_unknown_LU)
DVLR vlr_lu_fsm(GERAN-A-0_unknown_LU){VLR_ULA_S_IDLE}: rev=GSM net=GERAN (no Auth)
DVLR vlr_lu_fsm(GERAN-A-0_unknown_LU){VLR_ULA_S_IDLE}: Received Event VLR_ULA_E_UPDATE_LA
DREF VLR subscr unknown usage increases to: 1
DVLR set IMSI on subscriber; IMSI=901700000004620 id=901700000004620
DVLR New subscr, IMSI: 901700000004620
DREF VLR subscr IMSI-901700000004620 usage increases to: 2
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_LU){RAN_CONN_S_NEW}: Updated ID
DREF VLR subscr IMSI-901700000004620 usage decreases to: 1
DVLR vlr_lu_fsm(GERAN-A-0_IMSI-901700000004620_LU){VLR_ULA_S_IDLE}: vlr_loc_upd_node1()
DVLR vlr_lu_fsm(GERAN-A-0_IMSI-901700000004620_LU){VLR_ULA_S_IDLE}: vlr_loc_upd_post_auth()
DVLR vlr_lu_fsm(GERAN-A-0_IMSI-901700000004620_LU){VLR_ULA_S_IDLE}: vlr_loc_upd_post_ciph()
DVLR vlr_lu_fsm(GERAN-A-0_IMSI-901700000004620_LU){VLR_ULA_S_IDLE}: vlr_loc_upd_node_4()
DVLR vlr_lu_fsm(GERAN-A-0_IMSI-901700000004620_LU){VLR_ULA_S_IDLE}: state_chg to VLR_ULA_S_WAIT_HLR_UPD
DVLR upd_hlr_vlr_fsm(GERAN-A-0_IMSI-901700000004620_LU){UPD_HLR_VLR_S_INIT}: Allocated
DVLR upd_hlr_vlr_fsm(GERAN-A-0_IMSI-901700000004620_LU){UPD_HLR_VLR_S_INIT}: is child of vlr_lu_fsm(GERAN-A-0_IMSI-901700000004620_LU)
DVLR upd_hlr_vlr_fsm(GERAN-A-0_IMSI-901700000004620_LU){UPD_HLR_VLR_S_INIT}: Received Event UPD_HLR_VLR_E_START
DVLR GSUP tx: 04010809710000004026f0280102290101
GSUP --> HLR: OSMO_GSUP_MSGT_UPDATE_LOCATION_REQUEST: 04010809710000004026f0280102290101
DVLR upd_hlr_vlr_fsm(GERAN-A-0_IMSI-901700000004620_LU){UPD_HLR_VLR_S_INIT}: state_chg to UPD_HLR_VLR_S_WAIT_FOR_DATA
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_LU){RAN_CONN_S_NEW}: Received Event RAN_CONN_E_COMPLETE_LAYER_3
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_LU){RAN_CONN_S_NEW}: state_chg to RAN_CONN_S_AUTH_CIPH
DREF IMSI-901700000004620: MSC conn use - compl_l3 == 0 (0x0: )
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_LU){RAN_CONN_S_AUTH_CIPH}: Received Event RAN_CONN_E_UNUSED
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_LU){RAN_CONN_S_AUTH_CIPH}: Awaiting results for Auth+Ciph, overruling event RAN_CONN_E_UNUSED
  lu_result_sent == 0
  llist_count(&net->ran_conns) == 1
- HLR sends _INSERT_DATA_REQUEST, VLR responds with _INSERT_DATA_RESULT
<-- GSUP rx OSMO_GSUP_MSGT_INSERT_DATA_REQUEST: 10010809710000004026f00804036470f1
DVLR GSUP rx 17: 10010809710000004026f00804036470f1
DREF VLR subscr IMSI-901700000004620 usage increases to: 2
DVLR IMSI:901700000004620 has MSISDN:46071
DVLR SUBSCR(IMSI-901700000004620_MSISDN-46071) VLR: update for IMSI=901700000004620 (MSISDN=46071, used=2)
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){RAN_CONN_S_AUTH_CIPH}: Updated ID
DVLR GSUP tx: 12010809710000004026f0
GSUP --> HLR: OSMO_GSUP_MSGT_INSERT_DATA_RESULT: 12010809710000004026f0
DREF VLR subscr IMSI-901700000004620_MSISDN-46071 usage decreases to: 1
<-- GSUP rx OSMO_GSUP_MSGT_INSERT_DATA_REQUEST: vlr_gsupc_read_cb() returns 0
  lu_result_sent == 0
- HLR also sends GSUP _UPDATE_LOCATION_RESULT
<-- GSUP rx OSMO_GSUP_MSGT_UPDATE_LOCATION_RESULT: 06010809710000004026f0
DVLR GSUP rx 11: 06010809710000004026f0
DREF VLR subscr IMSI-901700000004620_MSISDN-46071 usage increases to: 2
DVLR vlr_lu_fsm(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){VLR_ULA_S_WAIT_HLR_UPD}: Received Event VLR_ULA_E_HLR_LU_RES
DVLR upd_hlr_vlr_fsm(GERAN-A-0_IMSI-901700000004620_LU){UPD_HLR_VLR_S_WAIT_FOR_DATA}: Received Event UPD_HLR_VLR_E_UPD_LOC_ACK
DVLR upd_hlr_vlr_fsm(GERAN-A-0_IMSI-901700000004620_LU){UPD_HLR_VLR_S_WAIT_FOR_DATA}: state_chg to UPD_HLR_VLR_S_DONE
DVLR upd_hlr_vlr_fsm(GERAN-A-0_IMSI-901700000004620_LU){UPD_HLR_VLR_S_DONE}: Terminating (cause = OSMO_FSM_TERM_REGULAR)
DVLR upd_hlr_vlr_fsm(GERAN-A-0_IMSI-901700000004620_LU){UPD_HLR_VLR_S_DONE}: Removing from parent vlr_lu_fsm(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU)
DVLR upd_hlr_vlr_fsm(GERAN-A-0_IMSI-901700000004620_LU){UPD_HLR_VLR_S_DONE}: Freeing instance
DVLR upd_hlr_vlr_fsm(GERAN-A-0_IMSI-901700000004620_LU){UPD_HLR_VLR_S_DONE}: Deallocated
DVLR vlr_lu_fsm(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){VLR_ULA_S_WAIT_HLR_UPD}: Received Event VLR_ULA_E_UPD_HLR_COMPL
DVLR vlr_lu_fsm(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){VLR_ULA_S_WAIT_HLR_UPD}: state_chg to VLR_ULA_S_WAIT_LU_COMPL
DVLR lu_compl_vlr_fsm(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){LU_COMPL_VLR_S_INIT}: Allocated
DVLR lu_compl_vlr_fsm(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){LU_COMPL_VLR_S_INIT}: is child of vlr_lu_fsm(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU)
DVLR lu_compl_vlr_fsm(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){LU_COMPL_VLR_S_INIT}: Received Event LU_COMPL_VLR_E_START
DVLR lu_compl_vlr_fsm(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){LU_COMPL_VLR_S_INIT}: state_chg to LU_COMPL_VLR_S_WAIT_SUB_PRES
DVLR lu_compl_vlr_fsm(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){LU_COMPL_VLR_S_WAIT_SUB_PRES}: Received Event LU_COMPL_VLR_E_SUB_PRES_COMPL
- sending LU Accept for IMSI-901700000004620_MSISDN-46071
DREF VLR subscr IMSI-901700000004620_MSISDN-46071 usage increases to: 3
DVLR lu_compl_vlr_fsm(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){LU_COMPL_VLR_S_WAIT_SUB_PRES}: state_chg to LU_COMPL_VLR_S_DONE
DVLR vlr_lu_fsm(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){VLR_ULA_S_WAIT_LU_COMPL}: Received Event VLR_ULA_E_LU_COMPL_SUCCESS
DVLR lu_compl_vlr_fsm(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){LU_COMPL_VLR_S_DONE}: Terminating (cause = OSMO_FSM_TERM_PARENT)
DVLR lu_compl_vlr_fsm(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){LU_COMPL_VLR_S_DONE}: Removing from parent vlr_lu_fsm(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU)
DVLR lu_compl_vlr_fsm(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){LU_COMPL_VLR_S_DONE}: Freeing instance
DVLR lu_compl_vlr_fsm(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){LU_COMPL_VLR_S_DONE}: Deallocated
DVLR vlr_lu_fsm(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){VLR_ULA_S_WAIT_LU_COMPL}: state_chg to VLR_ULA_S_DONE
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){RAN_CONN_S_AUTH_CIPH}: Received Event RAN_CONN_E_ACCEPTED
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){RAN_CONN_S_AUTH_CIPH}: state_chg to RAN_CONN_S_ACCEPTED
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){RAN_CONN_S_ACCEPTED}: Received Event RAN_CONN_E_UNUSED
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){RAN_CONN_S_ACCEPTED}: state_chg to RAN_CONN_S_RELEASING
DREF IMSI-901700000004620_MSISDN-46071: MSC conn use + release == 1 (0x100: release)
DREF VLR subscr IMSI-901700000004620_MSISDN-46071 usage increases to: 4
DREF VLR subscr IMSI-901700000004620_MSISDN-46071 usage decreases to: 3
- BSSAP Clear --GERAN-A--> MS
DREF VLR subscr IMSI-901700000004620_MSISDN-46071 usage decreases to: 2
<-- GSUP rx OSMO_GSUP_MSGT_UPDATE_LOCATION_RESULT: vlr_gsupc_read_cb() returns 0
  bssap_clear_sent == 1
- LU was successful, and the conn has already been closed
  lu_result_sent == 1
- BSS sends BSSMAP Clear Complete
DREF IMSI-901700000004620_MSISDN-46071: MSC conn use - release == 0 (0x0: )
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){RAN_CONN_S_RELEASING}: Received Event RAN_CONN_E_UNUSED
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){RAN_CONN_S_RELEASING}: state_chg to RAN_CONN_S_RELEASED
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){RAN_CONN_S_RELEASED}: Terminating (cause = OSMO_FSM_TERM_REGULAR)
DVLR vlr_lu_fsm(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){VLR_ULA_S_DONE}: Terminating (cause = OSMO_FSM_TERM_PARENT)
DVLR vlr_lu_fsm(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){VLR_ULA_S_DONE}: Removing from parent RAN_conn(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU)
DVLR vlr_lu_fsm(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){VLR_ULA_S_DONE}: fsm_lu_cleanup called with cause OSMO_FSM_TERM_PARENT
DVLR vlr_lu_fsm(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){VLR_ULA_S_DONE}: Freeing instance
DVLR vlr_lu_fsm(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){VLR_ULA_S_DONE}: Deallocated
DRLL IMSI-901700000004620_MSISDN-46071: Freeing RAN connection
DREF VLR subscr IMSI-901700000004620_MSISDN-46071 usage decreases to: 1
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){RAN_CONN_S_RELEASED}: Freeing instance
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){RAN_CONN_S_RELEASED}: Deallocated
  llist_count(&net->ran_conns) == 0
---
- Subscriber does a normal CM Service Request
  MSC <--GERAN-A-- MS: GSM48_MT_MM_CM_SERV_REQ
  new conn
DMM RAN_conn{RAN_CONN_S_NEW}: Allocated
DREF unknown: MSC conn use + compl_l3 == 1 (0x1: compl_l3)
DRLL Dispatching 04.08 message GSM48_MT_MM_CM_SERV_REQ (0x5:0x24)
DMM <- CM SERVICE REQUEST serv_type=0x08 MI(IMSI)=901700000004620
DMM RAN_conn(GERAN-A-0_unknown_CM_SERVICE_REQ){RAN_CONN_S_NEW}: Updated ID
DVLR Process_Access_Request_VLR(GERAN-A-0_unknown_CM_SERVICE_REQ){PR_ARQ_S_INIT}: Allocated
DVLR Process_Access_Request_VLR(GERAN-A-0_unknown_CM_SERVICE_REQ){PR_ARQ_S_INIT}: is child of RAN_conn(GERAN-A-0_unknown_CM_SERVICE_REQ)
DVLR Process_Access_Request_VLR(GERAN-A-0_unknown_CM_SERVICE_REQ){PR_ARQ_S_INIT}: rev=GSM net=GERAN (no Auth)
DVLR Process_Access_Request_VLR(GERAN-A-0_unknown_CM_SERVICE_REQ){PR_ARQ_S_INIT}: Received Event PR_ARQ_E_START
DREF VLR subscr IMSI-901700000004620_MSISDN-46071 usage increases to: 2
DREF VLR subscr IMSI-901700000004620_MSISDN-46071 usage increases to: 3
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_CM_SERVICE_REQ){RAN_CONN_S_NEW}: Updated ID
DVLR Process_Access_Request_VLR(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_CM_SERVICE_REQ){PR_ARQ_S_INIT}: proc_arq_vlr_fn_post_imsi()
DVLR Process_Access_Request_VLR(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_CM_SERVICE_REQ){PR_ARQ_S_INIT}: _proc_arq_vlr_node2()
DVLR Process_Access_Request_VLR(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_CM_SERVICE_REQ){PR_ARQ_S_INIT}: _proc_arq_vlr_node2_post_ciph()
DVLR Process_Access_Request_VLR(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_CM_SERVICE_REQ){PR_ARQ_S_INIT}: _proc_arq_vlr_node2_post_vlr()
DVLR Process_Access_Request_VLR(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_CM_SERVICE_REQ){PR_ARQ_S_INIT}: _proc_arq_vlr_post_pres()
DVLR Process_Access_Request_VLR(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_CM_SERVICE_REQ){PR_ARQ_S_INIT}: _proc_arq_vlr_post_trace()
DVLR Process_Access_Request_VLR(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_CM_SERVICE_REQ){PR_ARQ_S_INIT}: _proc_arq_vlr_post_imei()
DVLR Process_Access_Request_VLR(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_CM_SERVICE_REQ){PR_ARQ_S_INIT}: proc_arq_fsm_done(PASSED)
DVLR Process_Access_Request_VLR(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_CM_SERVICE_REQ){PR_ARQ_S_INIT}: state_chg to PR_ARQ_S_DONE
DVLR Process_Access_Request_VLR(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_CM_SERVICE_REQ){PR_ARQ_S_DONE}: Process Access Request result: PASSED
- sending CM Service Accept for IMSI-901700000004620_MSISDN-46071
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_CM_SERVICE_REQ){RAN_CONN_S_NEW}: Received Event RAN_CONN_E_ACCEPTED
DREF IMSI-901700000004620_MSISDN-46071: MSC conn use + cm_service == 2 (0x9: compl_l3,cm_service)
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_CM_SERVICE_REQ){RAN_CONN_S_NEW}: state_chg to RAN_CONN_S_ACCEPTED
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_CM_SERVICE_REQ){RAN_CONN_S_ACCEPTED}: ran_conn_fsm_has_active_transactions: still awaiting first request after a CM Service Request
DREF VLR subscr IMSI-901700000004620_MSISDN-46071 usage decreases to: 2
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_CM_SERVICE_REQ){RAN_CONN_S_ACCEPTED}: Received Event RAN_CONN_E_COMPLETE_LAYER_3
DREF IMSI-901700000004620_MSISDN-46071: MSC conn use - compl_l3 == 1 (0x8: cm_service)
  cm_service_result_sent == 1
ran_conn_is_accepted() == true
- A LU request on an open conn is dropped silently
  MSC <--GERAN-A-- MS: GSM48_MT_MM_LOC_UPD_REQUEST
DREF IMSI-901700000004620_MSISDN-46071: MSC conn use + dtap == 2 (0xa: dtap,cm_service)
DRLL Dispatching 04.08 message GSM48_MT_MM_LOC_UPD_REQUEST (0x5:0x8)
DMM Cannot accept another LU, conn already established; extraneous LOCATION UPDATING REQUEST: MI(IMSI)=901700000004620 type=IMSI ATTACH
DREF IMSI-901700000004620_MSISDN-46071: MSC conn use - dtap == 1 (0x8: cm_service)
  lu_result_sent == 0
  llist_count(&net->ran_conns) == 1
---
- subscriber detaches
  MSC <--GERAN-A-- MS: GSM48_MT_MM_IMSI_DETACH_IND
DREF IMSI-901700000004620_MSISDN-46071: MSC conn use + dtap == 2 (0xa: dtap,cm_service)
DRLL Dispatching 04.08 message GSM48_MT_MM_IMSI_DETACH_IND (0x5:0x1)
DMM IMSI DETACH INDICATION: MI(IMSI)=901700000004620
DREF VLR subscr IMSI-901700000004620_MSISDN-46071 usage increases to: 3
DMM IMSI DETACH for IMSI-901700000004620_MSISDN-46071
DREF VLR subscr IMSI-901700000004620_MSISDN-46071 usage increases to: 4
DREF VLR subscr IMSI-901700000004620_MSISDN-46071 usage decreases to: 3
DREF VLR subscr IMSI-901700000004620_MSISDN-46071 usage decreases to: 2
DREF VLR subscr IMSI-901700000004620_MSISDN-46071 usage decreases to: 1
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_CM_SERVICE_REQ){RAN_CONN_S_ACCEPTED}: Received Event RAN_CONN_E_CN_CLOSE
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_CM_SERVICE_REQ){RAN_CONN_S_ACCEPTED}: state_chg to RAN_CONN_S_RELEASING
DREF IMSI-901700000004620_MSISDN-46071: MSC conn use + release == 3 (0x10a: dtap,cm_service,release)
DREF IMSI-901700000004620_MSISDN-46071: MSC conn use - cm_service == 2 (0x102: dtap,release)
DREF VLR subscr IMSI-901700000004620_MSISDN-46071 usage increases to: 2
DREF VLR subscr IMSI-901700000004620_MSISDN-46071 usage decreases to: 1
- BSSAP Clear --GERAN-A--> MS
DREF IMSI-901700000004620_MSISDN-46071: MSC conn use - dtap == 1 (0x100: release)
  bssap_clear_sent == 1
- BSS sends BSSMAP Clear Complete
DREF IMSI-901700000004620_MSISDN-46071: MSC conn use - release == 0 (0x0: )
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_CM_SERVICE_REQ){RAN_CONN_S_RELEASING}: Received Event RAN_CONN_E_UNUSED
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_CM_SERVICE_REQ){RAN_CONN_S_RELEASING}: state_chg to RAN_CONN_S_RELEASED
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_CM_SERVICE_REQ){RAN_CONN_S_RELEASED}: Terminating (cause = OSMO_FSM_TERM_REGULAR)
DVLR Process_Access_Request_VLR(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_CM_SERVICE_REQ){PR_ARQ_S_DONE}: Terminating (cause = OSMO_FSM_TERM_PARENT)
DVLR Process_Access_Request_VLR(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_CM_SERVICE_REQ){PR_ARQ_S_DONE}: Removing from parent RAN_conn(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_CM_SERVICE_REQ)
DVLR Process_Access_Request_VLR(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_CM_SERVICE_REQ){PR_ARQ_S_DONE}: Freeing instance
DVLR Process_Access_Request_VLR(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_CM_SERVICE_REQ){PR_ARQ_S_DONE}: Deallocated
DRLL IMSI-901700000004620_MSISDN-46071: Freeing RAN connection
DREF VLR subscr IMSI-901700000004620_MSISDN-46071 usage decreases to: 0
DREF freeing VLR subscr IMSI-901700000004620_MSISDN-46071
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_CM_SERVICE_REQ){RAN_CONN_S_RELEASED}: Freeing instance
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_CM_SERVICE_REQ){RAN_CONN_S_RELEASED}: Deallocated
  llist_count(&net->ran_conns) == 0
===== test_reject_lu_during_cm: SUCCESS

full talloc report on 'msgb' (total      0 bytes in   1 blocks)
talloc_total_blocks(tall_bsc_ctx) == 13

===== test_reject_cm_during_cm
---
- Subscriber does a normal LU
- Location Update Request
  MSC <--GERAN-A-- MS: GSM48_MT_MM_LOC_UPD_REQUEST
  new conn
DMM RAN_conn{RAN_CONN_S_NEW}: Allocated
DREF unknown: MSC conn use + compl_l3 == 1 (0x1: compl_l3)
DRLL Dispatching 04.08 message GSM48_MT_MM_LOC_UPD_REQUEST (0x5:0x8)
DMM RAN_conn(GERAN-A-0_unknown_LU){RAN_CONN_S_NEW}: Updated ID
DMM LOCATION UPDATING REQUEST: MI(IMSI)=901700000004620 type=IMSI ATTACH
DMM LU/new-LAC: 1/23
DVLR vlr_lu_fsm(GERAN-A-0_unknown_LU){VLR_ULA_S_IDLE}: Allocated
DVLR vlr_lu_fsm(GERAN-A-0_unknown_LU){VLR_ULA_S_IDLE}: is child of RAN_conn(GERAN-A-0_unknown_LU)
DVLR vlr_lu_fsm(GERAN-A-0_unknown_LU){VLR_ULA_S_IDLE}: rev=GSM net=GERAN (no Auth)
DVLR vlr_lu_fsm(GERAN-A-0_unknown_LU){VLR_ULA_S_IDLE}: Received Event VLR_ULA_E_UPDATE_LA
DREF VLR subscr unknown usage increases to: 1
DVLR set IMSI on subscriber; IMSI=901700000004620 id=901700000004620
DVLR New subscr, IMSI: 901700000004620
DREF VLR subscr IMSI-901700000004620 usage increases to: 2
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_LU){RAN_CONN_S_NEW}: Updated ID
DREF VLR subscr IMSI-901700000004620 usage decreases to: 1
DVLR vlr_lu_fsm(GERAN-A-0_IMSI-901700000004620_LU){VLR_ULA_S_IDLE}: vlr_loc_upd_node1()
DVLR vlr_lu_fsm(GERAN-A-0_IMSI-901700000004620_LU){VLR_ULA_S_IDLE}: vlr_loc_upd_post_auth()
DVLR vlr_lu_fsm(GERAN-A-0_IMSI-901700000004620_LU){VLR_ULA_S_IDLE}: vlr_loc_upd_post_ciph()
DVLR vlr_lu_fsm(GERAN-A-0_IMSI-901700000004620_LU){VLR_ULA_S_IDLE}: vlr_loc_upd_node_4()
DVLR vlr_lu_fsm(GERAN-A-0_IMSI-901700000004620_LU){VLR_ULA_S_IDLE}: state_chg to VLR_ULA_S_WAIT_HLR_UPD
DVLR upd_hlr_vlr_fsm(GERAN-A-0_IMSI-901700000004620_LU){UPD_HLR_VLR_S_INIT}: Allocated
DVLR upd_hlr_vlr_fsm(GERAN-A-0_IMSI-901700000004620_LU){UPD_HLR_VLR_S_INIT}: is child of vlr_lu_fsm(GERAN-A-0_IMSI-901700000004620_LU)
DVLR upd_hlr_vlr_fsm(GERAN-A-0_IMSI-901700000004620_LU){UPD_HLR_VLR_S_INIT}: Received Event UPD_HLR_VLR_E_START
DVLR GSUP tx: 04010809710000004026f0280102290101
GSUP --> HLR: OSMO_GSUP_MSGT_UPDATE_LOCATION_REQUEST: 04010809710000004026f0280102290101
DVLR upd_hlr_vlr_fsm(GERAN-A-0_IMSI-901700000004620_LU){UPD_HLR_VLR_S_INIT}: state_chg to UPD_HLR_VLR_S_WAIT_FOR_DATA
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_LU){RAN_CONN_S_NEW}: Received Event RAN_CONN_E_COMPLETE_LAYER_3
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_LU){RAN_CONN_S_NEW}: state_chg to RAN_CONN_S_AUTH_CIPH
DREF IMSI-901700000004620: MSC conn use - compl_l3 == 0 (0x0: )
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_LU){RAN_CONN_S_AUTH_CIPH}: Received Event RAN_CONN_E_UNUSED
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_LU){RAN_CONN_S_AUTH_CIPH}: Awaiting results for Auth+Ciph, overruling event RAN_CONN_E_UNUSED
  lu_result_sent == 0
  llist_count(&net->ran_conns) == 1
- HLR sends _INSERT_DATA_REQUEST, VLR responds with _INSERT_DATA_RESULT
<-- GSUP rx OSMO_GSUP_MSGT_INSERT_DATA_REQUEST: 10010809710000004026f00804036470f1
DVLR GSUP rx 17: 10010809710000004026f00804036470f1
DREF VLR subscr IMSI-901700000004620 usage increases to: 2
DVLR IMSI:901700000004620 has MSISDN:46071
DVLR SUBSCR(IMSI-901700000004620_MSISDN-46071) VLR: update for IMSI=901700000004620 (MSISDN=46071, used=2)
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){RAN_CONN_S_AUTH_CIPH}: Updated ID
DVLR GSUP tx: 12010809710000004026f0
GSUP --> HLR: OSMO_GSUP_MSGT_INSERT_DATA_RESULT: 12010809710000004026f0
DREF VLR subscr IMSI-901700000004620_MSISDN-46071 usage decreases to: 1
<-- GSUP rx OSMO_GSUP_MSGT_INSERT_DATA_REQUEST: vlr_gsupc_read_cb() returns 0
  lu_result_sent == 0
- HLR also sends GSUP _UPDATE_LOCATION_RESULT
<-- GSUP rx OSMO_GSUP_MSGT_UPDATE_LOCATION_RESULT: 06010809710000004026f0
DVLR GSUP rx 11: 06010809710000004026f0
DREF VLR subscr IMSI-901700000004620_MSISDN-46071 usage increases to: 2
DVLR vlr_lu_fsm(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){VLR_ULA_S_WAIT_HLR_UPD}: Received Event VLR_ULA_E_HLR_LU_RES
DVLR upd_hlr_vlr_fsm(GERAN-A-0_IMSI-901700000004620_LU){UPD_HLR_VLR_S_WAIT_FOR_DATA}: Received Event UPD_HLR_VLR_E_UPD_LOC_ACK
DVLR upd_hlr_vlr_fsm(GERAN-A-0_IMSI-901700000004620_LU){UPD_HLR_VLR_S_WAIT_FOR_DATA}: state_chg to UPD_HLR_VLR_S_DONE
DVLR upd_hlr_vlr_fsm(GERAN-A-0_IMSI-901700000004620_LU){UPD_HLR_VLR_S_DONE}: Terminating (cause = OSMO_FSM_TERM_REGULAR)
DVLR upd_hlr_vlr_fsm(GERAN-A-0_IMSI-901700000004620_LU){UPD_HLR_VLR_S_DONE}: Removing from parent vlr_lu_fsm(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU)
DVLR upd_hlr_vlr_fsm(GERAN-A-0_IMSI-901700000004620_LU){UPD_HLR_VLR_S_DONE}: Freeing instance
DVLR upd_hlr_vlr_fsm(GERAN-A-0_IMSI-901700000004620_LU){UPD_HLR_VLR_S_DONE}: Deallocated
DVLR vlr_lu_fsm(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){VLR_ULA_S_WAIT_HLR_UPD}: Received Event VLR_ULA_E_UPD_HLR_COMPL
DVLR vlr_lu_fsm(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){VLR_ULA_S_WAIT_HLR_UPD}: state_chg to VLR_ULA_S_WAIT_LU_COMPL
DVLR lu_compl_vlr_fsm(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){LU_COMPL_VLR_S_INIT}: Allocated
DVLR lu_compl_vlr_fsm(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){LU_COMPL_VLR_S_INIT}: is child of vlr_lu_fsm(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU)
DVLR lu_compl_vlr_fsm(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){LU_COMPL_VLR_S_INIT}: Received Event LU_COMPL_VLR_E_START
DVLR lu_compl_vlr_fsm(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){LU_COMPL_VLR_S_INIT}: state_chg to LU_COMPL_VLR_S_WAIT_SUB_PRES
DVLR lu_compl_vlr_fsm(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){LU_COMPL_VLR_S_WAIT_SUB_PRES}: Received Event LU_COMPL_VLR_E_SUB_PRES_COMPL
- sending LU Accept for IMSI-901700000004620_MSISDN-46071
DREF VLR subscr IMSI-901700000004620_MSISDN-46071 usage increases to: 3
DVLR lu_compl_vlr_fsm(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){LU_COMPL_VLR_S_WAIT_SUB_PRES}: state_chg to LU_COMPL_VLR_S_DONE
DVLR vlr_lu_fsm(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){VLR_ULA_S_WAIT_LU_COMPL}: Received Event VLR_ULA_E_LU_COMPL_SUCCESS
DVLR lu_compl_vlr_fsm(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){LU_COMPL_VLR_S_DONE}: Terminating (cause = OSMO_FSM_TERM_PARENT)
DVLR lu_compl_vlr_fsm(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){LU_COMPL_VLR_S_DONE}: Removing from parent vlr_lu_fsm(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU)
DVLR lu_compl_vlr_fsm(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){LU_COMPL_VLR_S_DONE}: Freeing instance
DVLR lu_compl_vlr_fsm(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){LU_COMPL_VLR_S_DONE}: Deallocated
DVLR vlr_lu_fsm(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){VLR_ULA_S_WAIT_LU_COMPL}: state_chg to VLR_ULA_S_DONE
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){RAN_CONN_S_AUTH_CIPH}: Received Event RAN_CONN_E_ACCEPTED
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){RAN_CONN_S_AUTH_CIPH}: state_chg to RAN_CONN_S_ACCEPTED
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){RAN_CONN_S_ACCEPTED}: Received Event RAN_CONN_E_UNUSED
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){RAN_CONN_S_ACCEPTED}: state_chg to RAN_CONN_S_RELEASING
DREF IMSI-901700000004620_MSISDN-46071: MSC conn use + release == 1 (0x100: release)
DREF VLR subscr IMSI-901700000004620_MSISDN-46071 usage increases to: 4
DREF VLR subscr IMSI-901700000004620_MSISDN-46071 usage decreases to: 3
- BSSAP Clear --GERAN-A--> MS
DREF VLR subscr IMSI-901700000004620_MSISDN-46071 usage decreases to: 2
<-- GSUP rx OSMO_GSUP_MSGT_UPDATE_LOCATION_RESULT: vlr_gsupc_read_cb() returns 0
  bssap_clear_sent == 1
- LU was successful, and the conn has already been closed
  lu_result_sent == 1
- BSS sends BSSMAP Clear Complete
DREF IMSI-901700000004620_MSISDN-46071: MSC conn use - release == 0 (0x0: )
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){RAN_CONN_S_RELEASING}: Received Event RAN_CONN_E_UNUSED
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){RAN_CONN_S_RELEASING}: state_chg to RAN_CONN_S_RELEASED
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){RAN_CONN_S_RELEASED}: Terminating (cause = OSMO_FSM_TERM_REGULAR)
DVLR vlr_lu_fsm(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){VLR_ULA_S_DONE}: Terminating (cause = OSMO_FSM_TERM_PARENT)
DVLR vlr_lu_fsm(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){VLR_ULA_S_DONE}: Removing from parent RAN_conn(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU)
DVLR vlr_lu_fsm(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){VLR_ULA_S_DONE}: fsm_lu_cleanup called with cause OSMO_FSM_TERM_PARENT
DVLR vlr_lu_fsm(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){VLR_ULA_S_DONE}: Freeing instance
DVLR vlr_lu_fsm(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){VLR_ULA_S_DONE}: Deallocated
DRLL IMSI-901700000004620_MSISDN-46071: Freeing RAN connection
DREF VLR subscr IMSI-901700000004620_MSISDN-46071 usage decreases to: 1
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){RAN_CONN_S_RELEASED}: Freeing instance
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){RAN_CONN_S_RELEASED}: Deallocated
  llist_count(&net->ran_conns) == 0
---
- Subscriber does a normal CM Service Request
  MSC <--GERAN-A-- MS: GSM48_MT_MM_CM_SERV_REQ
  new conn
DMM RAN_conn{RAN_CONN_S_NEW}: Allocated
DREF unknown: MSC conn use + compl_l3 == 1 (0x1: compl_l3)
DRLL Dispatching 04.08 message GSM48_MT_MM_CM_SERV_REQ (0x5:0x24)
DMM <- CM SERVICE REQUEST serv_type=0x08 MI(IMSI)=901700000004620
DMM RAN_conn(GERAN-A-0_unknown_CM_SERVICE_REQ){RAN_CONN_S_NEW}: Updated ID
DVLR Process_Access_Request_VLR(GERAN-A-0_unknown_CM_SERVICE_REQ){PR_ARQ_S_INIT}: Allocated
DVLR Process_Access_Request_VLR(GERAN-A-0_unknown_CM_SERVICE_REQ){PR_ARQ_S_INIT}: is child of RAN_conn(GERAN-A-0_unknown_CM_SERVICE_REQ)
DVLR Process_Access_Request_VLR(GERAN-A-0_unknown_CM_SERVICE_REQ){PR_ARQ_S_INIT}: rev=GSM net=GERAN (no Auth)
DVLR Process_Access_Request_VLR(GERAN-A-0_unknown_CM_SERVICE_REQ){PR_ARQ_S_INIT}: Received Event PR_ARQ_E_START
DREF VLR subscr IMSI-901700000004620_MSISDN-46071 usage increases to: 2
DREF VLR subscr IMSI-901700000004620_MSISDN-46071 usage increases to: 3
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_CM_SERVICE_REQ){RAN_CONN_S_NEW}: Updated ID
DVLR Process_Access_Request_VLR(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_CM_SERVICE_REQ){PR_ARQ_S_INIT}: proc_arq_vlr_fn_post_imsi()
DVLR Process_Access_Request_VLR(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_CM_SERVICE_REQ){PR_ARQ_S_INIT}: _proc_arq_vlr_node2()
DVLR Process_Access_Request_VLR(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_CM_SERVICE_REQ){PR_ARQ_S_INIT}: _proc_arq_vlr_node2_post_ciph()
DVLR Process_Access_Request_VLR(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_CM_SERVICE_REQ){PR_ARQ_S_INIT}: _proc_arq_vlr_node2_post_vlr()
DVLR Process_Access_Request_VLR(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_CM_SERVICE_REQ){PR_ARQ_S_INIT}: _proc_arq_vlr_post_pres()
DVLR Process_Access_Request_VLR(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_CM_SERVICE_REQ){PR_ARQ_S_INIT}: _proc_arq_vlr_post_trace()
DVLR Process_Access_Request_VLR(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_CM_SERVICE_REQ){PR_ARQ_S_INIT}: _proc_arq_vlr_post_imei()
DVLR Process_Access_Request_VLR(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_CM_SERVICE_REQ){PR_ARQ_S_INIT}: proc_arq_fsm_done(PASSED)
DVLR Process_Access_Request_VLR(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_CM_SERVICE_REQ){PR_ARQ_S_INIT}: state_chg to PR_ARQ_S_DONE
DVLR Process_Access_Request_VLR(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_CM_SERVICE_REQ){PR_ARQ_S_DONE}: Process Access Request result: PASSED
- sending CM Service Accept for IMSI-901700000004620_MSISDN-46071
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_CM_SERVICE_REQ){RAN_CONN_S_NEW}: Received Event RAN_CONN_E_ACCEPTED
DREF IMSI-901700000004620_MSISDN-46071: MSC conn use + cm_service == 2 (0x9: compl_l3,cm_service)
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_CM_SERVICE_REQ){RAN_CONN_S_NEW}: state_chg to RAN_CONN_S_ACCEPTED
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_CM_SERVICE_REQ){RAN_CONN_S_ACCEPTED}: ran_conn_fsm_has_active_transactions: still awaiting first request after a CM Service Request
DREF VLR subscr IMSI-901700000004620_MSISDN-46071 usage decreases to: 2
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_CM_SERVICE_REQ){RAN_CONN_S_ACCEPTED}: Received Event RAN_CONN_E_COMPLETE_LAYER_3
DREF IMSI-901700000004620_MSISDN-46071: MSC conn use - compl_l3 == 1 (0x8: cm_service)
  cm_service_result_sent == 1
ran_conn_is_accepted() == true
- A second CM Service Request on the same conn is accepted without another auth dance
  MSC <--GERAN-A-- MS: GSM48_MT_MM_CM_SERV_REQ
DREF IMSI-901700000004620_MSISDN-46071: MSC conn use + dtap == 2 (0xa: dtap,cm_service)
DRLL Dispatching 04.08 message GSM48_MT_MM_CM_SERV_REQ (0x5:0x24)
DMM <- CM SERVICE REQUEST serv_type=0x08 MI(IMSI)=901700000004620
DMM IMSI-901700000004620_MSISDN-46071: re-using already accepted connection
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_CM_SERVICE_REQ){RAN_CONN_S_ACCEPTED}: Updated ID
- sending CM Service Accept for IMSI-901700000004620_MSISDN-46071
DREF IMSI-901700000004620_MSISDN-46071: MSC conn use - dtap == 1 (0x8: cm_service)
  cm_service_result_sent == 1
  llist_count(&net->ran_conns) == 1
---
- subscriber detaches
  MSC <--GERAN-A-- MS: GSM48_MT_MM_IMSI_DETACH_IND
DREF IMSI-901700000004620_MSISDN-46071: MSC conn use + dtap == 2 (0xa: dtap,cm_service)
DRLL Dispatching 04.08 message GSM48_MT_MM_IMSI_DETACH_IND (0x5:0x1)
DMM IMSI DETACH INDICATION: MI(IMSI)=901700000004620
DREF VLR subscr IMSI-901700000004620_MSISDN-46071 usage increases to: 3
DMM IMSI DETACH for IMSI-901700000004620_MSISDN-46071
DREF VLR subscr IMSI-901700000004620_MSISDN-46071 usage increases to: 4
DREF VLR subscr IMSI-901700000004620_MSISDN-46071 usage decreases to: 3
DREF VLR subscr IMSI-901700000004620_MSISDN-46071 usage decreases to: 2
DREF VLR subscr IMSI-901700000004620_MSISDN-46071 usage decreases to: 1
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_CM_SERVICE_REQ){RAN_CONN_S_ACCEPTED}: Received Event RAN_CONN_E_CN_CLOSE
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_CM_SERVICE_REQ){RAN_CONN_S_ACCEPTED}: state_chg to RAN_CONN_S_RELEASING
DREF IMSI-901700000004620_MSISDN-46071: MSC conn use + release == 3 (0x10a: dtap,cm_service,release)
DREF IMSI-901700000004620_MSISDN-46071: MSC conn use - cm_service == 2 (0x102: dtap,release)
DREF VLR subscr IMSI-901700000004620_MSISDN-46071 usage increases to: 2
DREF VLR subscr IMSI-901700000004620_MSISDN-46071 usage decreases to: 1
- BSSAP Clear --GERAN-A--> MS
DREF IMSI-901700000004620_MSISDN-46071: MSC conn use - dtap == 1 (0x100: release)
  bssap_clear_sent == 1
- BSS sends BSSMAP Clear Complete
DREF IMSI-901700000004620_MSISDN-46071: MSC conn use - release == 0 (0x0: )
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_CM_SERVICE_REQ){RAN_CONN_S_RELEASING}: Received Event RAN_CONN_E_UNUSED
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_CM_SERVICE_REQ){RAN_CONN_S_RELEASING}: state_chg to RAN_CONN_S_RELEASED
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_CM_SERVICE_REQ){RAN_CONN_S_RELEASED}: Terminating (cause = OSMO_FSM_TERM_REGULAR)
DVLR Process_Access_Request_VLR(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_CM_SERVICE_REQ){PR_ARQ_S_DONE}: Terminating (cause = OSMO_FSM_TERM_PARENT)
DVLR Process_Access_Request_VLR(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_CM_SERVICE_REQ){PR_ARQ_S_DONE}: Removing from parent RAN_conn(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_CM_SERVICE_REQ)
DVLR Process_Access_Request_VLR(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_CM_SERVICE_REQ){PR_ARQ_S_DONE}: Freeing instance
DVLR Process_Access_Request_VLR(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_CM_SERVICE_REQ){PR_ARQ_S_DONE}: Deallocated
DRLL IMSI-901700000004620_MSISDN-46071: Freeing RAN connection
DREF VLR subscr IMSI-901700000004620_MSISDN-46071 usage decreases to: 0
DREF freeing VLR subscr IMSI-901700000004620_MSISDN-46071
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_CM_SERVICE_REQ){RAN_CONN_S_RELEASED}: Freeing instance
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_CM_SERVICE_REQ){RAN_CONN_S_RELEASED}: Deallocated
  llist_count(&net->ran_conns) == 0
===== test_reject_cm_during_cm: SUCCESS

full talloc report on 'msgb' (total      0 bytes in   1 blocks)
talloc_total_blocks(tall_bsc_ctx) == 13

===== test_reject_paging_resp_during_cm
---
- Subscriber does a normal LU
- Location Update Request
  MSC <--GERAN-A-- MS: GSM48_MT_MM_LOC_UPD_REQUEST
  new conn
DMM RAN_conn{RAN_CONN_S_NEW}: Allocated
DREF unknown: MSC conn use + compl_l3 == 1 (0x1: compl_l3)
DRLL Dispatching 04.08 message GSM48_MT_MM_LOC_UPD_REQUEST (0x5:0x8)
DMM RAN_conn(GERAN-A-0_unknown_LU){RAN_CONN_S_NEW}: Updated ID
DMM LOCATION UPDATING REQUEST: MI(IMSI)=901700000004620 type=IMSI ATTACH
DMM LU/new-LAC: 1/23
DVLR vlr_lu_fsm(GERAN-A-0_unknown_LU){VLR_ULA_S_IDLE}: Allocated
DVLR vlr_lu_fsm(GERAN-A-0_unknown_LU){VLR_ULA_S_IDLE}: is child of RAN_conn(GERAN-A-0_unknown_LU)
DVLR vlr_lu_fsm(GERAN-A-0_unknown_LU){VLR_ULA_S_IDLE}: rev=GSM net=GERAN (no Auth)
DVLR vlr_lu_fsm(GERAN-A-0_unknown_LU){VLR_ULA_S_IDLE}: Received Event VLR_ULA_E_UPDATE_LA
DREF VLR subscr unknown usage increases to: 1
DVLR set IMSI on subscriber; IMSI=901700000004620 id=901700000004620
DVLR New subscr, IMSI: 901700000004620
DREF VLR subscr IMSI-901700000004620 usage increases to: 2
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_LU){RAN_CONN_S_NEW}: Updated ID
DREF VLR subscr IMSI-901700000004620 usage decreases to: 1
DVLR vlr_lu_fsm(GERAN-A-0_IMSI-901700000004620_LU){VLR_ULA_S_IDLE}: vlr_loc_upd_node1()
DVLR vlr_lu_fsm(GERAN-A-0_IMSI-901700000004620_LU){VLR_ULA_S_IDLE}: vlr_loc_upd_post_auth()
DVLR vlr_lu_fsm(GERAN-A-0_IMSI-901700000004620_LU){VLR_ULA_S_IDLE}: vlr_loc_upd_post_ciph()
DVLR vlr_lu_fsm(GERAN-A-0_IMSI-901700000004620_LU){VLR_ULA_S_IDLE}: vlr_loc_upd_node_4()
DVLR vlr_lu_fsm(GERAN-A-0_IMSI-901700000004620_LU){VLR_ULA_S_IDLE}: state_chg to VLR_ULA_S_WAIT_HLR_UPD
DVLR upd_hlr_vlr_fsm(GERAN-A-0_IMSI-901700000004620_LU){UPD_HLR_VLR_S_INIT}: Allocated
DVLR upd_hlr_vlr_fsm(GERAN-A-0_IMSI-901700000004620_LU){UPD_HLR_VLR_S_INIT}: is child of vlr_lu_fsm(GERAN-A-0_IMSI-901700000004620_LU)
DVLR upd_hlr_vlr_fsm(GERAN-A-0_IMSI-901700000004620_LU){UPD_HLR_VLR_S_INIT}: Received Event UPD_HLR_VLR_E_START
DVLR GSUP tx: 04010809710000004026f0280102290101
GSUP --> HLR: OSMO_GSUP_MSGT_UPDATE_LOCATION_REQUEST: 04010809710000004026f0280102290101
DVLR upd_hlr_vlr_fsm(GERAN-A-0_IMSI-901700000004620_LU){UPD_HLR_VLR_S_INIT}: state_chg to UPD_HLR_VLR_S_WAIT_FOR_DATA
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_LU){RAN_CONN_S_NEW}: Received Event RAN_CONN_E_COMPLETE_LAYER_3
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_LU){RAN_CONN_S_NEW}: state_chg to RAN_CONN_S_AUTH_CIPH
DREF IMSI-901700000004620: MSC conn use - compl_l3 == 0 (0x0: )
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_LU){RAN_CONN_S_AUTH_CIPH}: Received Event RAN_CONN_E_UNUSED
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_LU){RAN_CONN_S_AUTH_CIPH}: Awaiting results for Auth+Ciph, overruling event RAN_CONN_E_UNUSED
  lu_result_sent == 0
  llist_count(&net->ran_conns) == 1
- HLR sends _INSERT_DATA_REQUEST, VLR responds with _INSERT_DATA_RESULT
<-- GSUP rx OSMO_GSUP_MSGT_INSERT_DATA_REQUEST: 10010809710000004026f00804036470f1
DVLR GSUP rx 17: 10010809710000004026f00804036470f1
DREF VLR subscr IMSI-901700000004620 usage increases to: 2
DVLR IMSI:901700000004620 has MSISDN:46071
DVLR SUBSCR(IMSI-901700000004620_MSISDN-46071) VLR: update for IMSI=901700000004620 (MSISDN=46071, used=2)
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){RAN_CONN_S_AUTH_CIPH}: Updated ID
DVLR GSUP tx: 12010809710000004026f0
GSUP --> HLR: OSMO_GSUP_MSGT_INSERT_DATA_RESULT: 12010809710000004026f0
DREF VLR subscr IMSI-901700000004620_MSISDN-46071 usage decreases to: 1
<-- GSUP rx OSMO_GSUP_MSGT_INSERT_DATA_REQUEST: vlr_gsupc_read_cb() returns 0
  lu_result_sent == 0
- HLR also sends GSUP _UPDATE_LOCATION_RESULT
<-- GSUP rx OSMO_GSUP_MSGT_UPDATE_LOCATION_RESULT: 06010809710000004026f0
DVLR GSUP rx 11: 06010809710000004026f0
DREF VLR subscr IMSI-901700000004620_MSISDN-46071 usage increases to: 2
DVLR vlr_lu_fsm(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){VLR_ULA_S_WAIT_HLR_UPD}: Received Event VLR_ULA_E_HLR_LU_RES
DVLR upd_hlr_vlr_fsm(GERAN-A-0_IMSI-901700000004620_LU){UPD_HLR_VLR_S_WAIT_FOR_DATA}: Received Event UPD_HLR_VLR_E_UPD_LOC_ACK
DVLR upd_hlr_vlr_fsm(GERAN-A-0_IMSI-901700000004620_LU){UPD_HLR_VLR_S_WAIT_FOR_DATA}: state_chg to UPD_HLR_VLR_S_DONE
DVLR upd_hlr_vlr_fsm(GERAN-A-0_IMSI-901700000004620_LU){UPD_HLR_VLR_S_DONE}: Terminating (cause = OSMO_FSM_TERM_REGULAR)
DVLR upd_hlr_vlr_fsm(GERAN-A-0_IMSI-901700000004620_LU){UPD_HLR_VLR_S_DONE}: Removing from parent vlr_lu_fsm(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU)
DVLR upd_hlr_vlr_fsm(GERAN-A-0_IMSI-901700000004620_LU){UPD_HLR_VLR_S_DONE}: Freeing instance
DVLR upd_hlr_vlr_fsm(GERAN-A-0_IMSI-901700000004620_LU){UPD_HLR_VLR_S_DONE}: Deallocated
DVLR vlr_lu_fsm(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){VLR_ULA_S_WAIT_HLR_UPD}: Received Event VLR_ULA_E_UPD_HLR_COMPL
DVLR vlr_lu_fsm(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){VLR_ULA_S_WAIT_HLR_UPD}: state_chg to VLR_ULA_S_WAIT_LU_COMPL
DVLR lu_compl_vlr_fsm(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){LU_COMPL_VLR_S_INIT}: Allocated
DVLR lu_compl_vlr_fsm(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){LU_COMPL_VLR_S_INIT}: is child of vlr_lu_fsm(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU)
DVLR lu_compl_vlr_fsm(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){LU_COMPL_VLR_S_INIT}: Received Event LU_COMPL_VLR_E_START
DVLR lu_compl_vlr_fsm(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){LU_COMPL_VLR_S_INIT}: state_chg to LU_COMPL_VLR_S_WAIT_SUB_PRES
DVLR lu_compl_vlr_fsm(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){LU_COMPL_VLR_S_WAIT_SUB_PRES}: Received Event LU_COMPL_VLR_E_SUB_PRES_COMPL
- sending LU Accept for IMSI-901700000004620_MSISDN-46071
DREF VLR subscr IMSI-901700000004620_MSISDN-46071 usage increases to: 3
DVLR lu_compl_vlr_fsm(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){LU_COMPL_VLR_S_WAIT_SUB_PRES}: state_chg to LU_COMPL_VLR_S_DONE
DVLR vlr_lu_fsm(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){VLR_ULA_S_WAIT_LU_COMPL}: Received Event VLR_ULA_E_LU_COMPL_SUCCESS
DVLR lu_compl_vlr_fsm(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){LU_COMPL_VLR_S_DONE}: Terminating (cause = OSMO_FSM_TERM_PARENT)
DVLR lu_compl_vlr_fsm(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){LU_COMPL_VLR_S_DONE}: Removing from parent vlr_lu_fsm(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU)
DVLR lu_compl_vlr_fsm(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){LU_COMPL_VLR_S_DONE}: Freeing instance
DVLR lu_compl_vlr_fsm(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){LU_COMPL_VLR_S_DONE}: Deallocated
DVLR vlr_lu_fsm(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){VLR_ULA_S_WAIT_LU_COMPL}: state_chg to VLR_ULA_S_DONE
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){RAN_CONN_S_AUTH_CIPH}: Received Event RAN_CONN_E_ACCEPTED
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){RAN_CONN_S_AUTH_CIPH}: state_chg to RAN_CONN_S_ACCEPTED
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){RAN_CONN_S_ACCEPTED}: Received Event RAN_CONN_E_UNUSED
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){RAN_CONN_S_ACCEPTED}: state_chg to RAN_CONN_S_RELEASING
DREF IMSI-901700000004620_MSISDN-46071: MSC conn use + release == 1 (0x100: release)
DREF VLR subscr IMSI-901700000004620_MSISDN-46071 usage increases to: 4
DREF VLR subscr IMSI-901700000004620_MSISDN-46071 usage decreases to: 3
- BSSAP Clear --GERAN-A--> MS
DREF VLR subscr IMSI-901700000004620_MSISDN-46071 usage decreases to: 2
<-- GSUP rx OSMO_GSUP_MSGT_UPDATE_LOCATION_RESULT: vlr_gsupc_read_cb() returns 0
  bssap_clear_sent == 1
- LU was successful, and the conn has already been closed
  lu_result_sent == 1
- BSS sends BSSMAP Clear Complete
DREF IMSI-901700000004620_MSISDN-46071: MSC conn use - release == 0 (0x0: )
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){RAN_CONN_S_RELEASING}: Received Event RAN_CONN_E_UNUSED
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){RAN_CONN_S_RELEASING}: state_chg to RAN_CONN_S_RELEASED
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){RAN_CONN_S_RELEASED}: Terminating (cause = OSMO_FSM_TERM_REGULAR)
DVLR vlr_lu_fsm(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){VLR_ULA_S_DONE}: Terminating (cause = OSMO_FSM_TERM_PARENT)
DVLR vlr_lu_fsm(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){VLR_ULA_S_DONE}: Removing from parent RAN_conn(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU)
DVLR vlr_lu_fsm(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){VLR_ULA_S_DONE}: fsm_lu_cleanup called with cause OSMO_FSM_TERM_PARENT
DVLR vlr_lu_fsm(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){VLR_ULA_S_DONE}: Freeing instance
DVLR vlr_lu_fsm(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){VLR_ULA_S_DONE}: Deallocated
DRLL IMSI-901700000004620_MSISDN-46071: Freeing RAN connection
DREF VLR subscr IMSI-901700000004620_MSISDN-46071 usage decreases to: 1
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){RAN_CONN_S_RELEASED}: Freeing instance
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){RAN_CONN_S_RELEASED}: Deallocated
  llist_count(&net->ran_conns) == 0
---
- Subscriber does a normal CM Service Request
  MSC <--GERAN-A-- MS: GSM48_MT_MM_CM_SERV_REQ
  new conn
DMM RAN_conn{RAN_CONN_S_NEW}: Allocated
DREF unknown: MSC conn use + compl_l3 == 1 (0x1: compl_l3)
DRLL Dispatching 04.08 message GSM48_MT_MM_CM_SERV_REQ (0x5:0x24)
DMM <- CM SERVICE REQUEST serv_type=0x08 MI(IMSI)=901700000004620
DMM RAN_conn(GERAN-A-0_unknown_CM_SERVICE_REQ){RAN_CONN_S_NEW}: Updated ID
DVLR Process_Access_Request_VLR(GERAN-A-0_unknown_CM_SERVICE_REQ){PR_ARQ_S_INIT}: Allocated
DVLR Process_Access_Request_VLR(GERAN-A-0_unknown_CM_SERVICE_REQ){PR_ARQ_S_INIT}: is child of RAN_conn(GERAN-A-0_unknown_CM_SERVICE_REQ)
DVLR Process_Access_Request_VLR(GERAN-A-0_unknown_CM_SERVICE_REQ){PR_ARQ_S_INIT}: rev=GSM net=GERAN (no Auth)
DVLR Process_Access_Request_VLR(GERAN-A-0_unknown_CM_SERVICE_REQ){PR_ARQ_S_INIT}: Received Event PR_ARQ_E_START
DREF VLR subscr IMSI-901700000004620_MSISDN-46071 usage increases to: 2
DREF VLR subscr IMSI-901700000004620_MSISDN-46071 usage increases to: 3
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_CM_SERVICE_REQ){RAN_CONN_S_NEW}: Updated ID
DVLR Process_Access_Request_VLR(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_CM_SERVICE_REQ){PR_ARQ_S_INIT}: proc_arq_vlr_fn_post_imsi()
DVLR Process_Access_Request_VLR(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_CM_SERVICE_REQ){PR_ARQ_S_INIT}: _proc_arq_vlr_node2()
DVLR Process_Access_Request_VLR(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_CM_SERVICE_REQ){PR_ARQ_S_INIT}: _proc_arq_vlr_node2_post_ciph()
DVLR Process_Access_Request_VLR(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_CM_SERVICE_REQ){PR_ARQ_S_INIT}: _proc_arq_vlr_node2_post_vlr()
DVLR Process_Access_Request_VLR(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_CM_SERVICE_REQ){PR_ARQ_S_INIT}: _proc_arq_vlr_post_pres()
DVLR Process_Access_Request_VLR(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_CM_SERVICE_REQ){PR_ARQ_S_INIT}: _proc_arq_vlr_post_trace()
DVLR Process_Access_Request_VLR(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_CM_SERVICE_REQ){PR_ARQ_S_INIT}: _proc_arq_vlr_post_imei()
DVLR Process_Access_Request_VLR(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_CM_SERVICE_REQ){PR_ARQ_S_INIT}: proc_arq_fsm_done(PASSED)
DVLR Process_Access_Request_VLR(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_CM_SERVICE_REQ){PR_ARQ_S_INIT}: state_chg to PR_ARQ_S_DONE
DVLR Process_Access_Request_VLR(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_CM_SERVICE_REQ){PR_ARQ_S_DONE}: Process Access Request result: PASSED
- sending CM Service Accept for IMSI-901700000004620_MSISDN-46071
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_CM_SERVICE_REQ){RAN_CONN_S_NEW}: Received Event RAN_CONN_E_ACCEPTED
DREF IMSI-901700000004620_MSISDN-46071: MSC conn use + cm_service == 2 (0x9: compl_l3,cm_service)
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_CM_SERVICE_REQ){RAN_CONN_S_NEW}: state_chg to RAN_CONN_S_ACCEPTED
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_CM_SERVICE_REQ){RAN_CONN_S_ACCEPTED}: ran_conn_fsm_has_active_transactions: still awaiting first request after a CM Service Request
DREF VLR subscr IMSI-901700000004620_MSISDN-46071 usage decreases to: 2
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_CM_SERVICE_REQ){RAN_CONN_S_ACCEPTED}: Received Event RAN_CONN_E_COMPLETE_LAYER_3
DREF IMSI-901700000004620_MSISDN-46071: MSC conn use - compl_l3 == 1 (0x8: cm_service)
  cm_service_result_sent == 1
ran_conn_is_accepted() == true
---
- An erratic Paging Response on the same conn is dropped silently
  MSC <--GERAN-A-- MS: GSM48_MT_RR_PAG_RESP
DREF IMSI-901700000004620_MSISDN-46071: MSC conn use + dtap == 2 (0xa: dtap,cm_service)
DRLL Dispatching 04.08 message GSM48_MT_RR_PAG_RESP (0x6:0x27)
DMM Ignoring Paging Response, conn already established
DREF IMSI-901700000004620_MSISDN-46071: MSC conn use - dtap == 1 (0x8: cm_service)
  llist_count(&net->ran_conns) == 1
---
- The original CM Service Request can conclude
- Concluding CM Service Request
DREF IMSI-901700000004620_MSISDN-46071: MSC conn use - cm_service == 0 (0x0: )
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_CM_SERVICE_REQ){RAN_CONN_S_ACCEPTED}: Received Event RAN_CONN_E_UNUSED
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_CM_SERVICE_REQ){RAN_CONN_S_ACCEPTED}: state_chg to RAN_CONN_S_RELEASING
DREF IMSI-901700000004620_MSISDN-46071: MSC conn use + release == 1 (0x100: release)
DREF VLR subscr IMSI-901700000004620_MSISDN-46071 usage increases to: 3
DREF VLR subscr IMSI-901700000004620_MSISDN-46071 usage decreases to: 2
- BSSAP Clear --GERAN-A--> MS
  bssap_clear_sent == 1
- all requests serviced, conn has been released
- BSS sends BSSMAP Clear Complete
DREF IMSI-901700000004620_MSISDN-46071: MSC conn use - release == 0 (0x0: )
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_CM_SERVICE_REQ){RAN_CONN_S_RELEASING}: Received Event RAN_CONN_E_UNUSED
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_CM_SERVICE_REQ){RAN_CONN_S_RELEASING}: state_chg to RAN_CONN_S_RELEASED
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_CM_SERVICE_REQ){RAN_CONN_S_RELEASED}: Terminating (cause = OSMO_FSM_TERM_REGULAR)
DVLR Process_Access_Request_VLR(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_CM_SERVICE_REQ){PR_ARQ_S_DONE}: Terminating (cause = OSMO_FSM_TERM_PARENT)
DVLR Process_Access_Request_VLR(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_CM_SERVICE_REQ){PR_ARQ_S_DONE}: Removing from parent RAN_conn(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_CM_SERVICE_REQ)
DVLR Process_Access_Request_VLR(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_CM_SERVICE_REQ){PR_ARQ_S_DONE}: Freeing instance
DVLR Process_Access_Request_VLR(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_CM_SERVICE_REQ){PR_ARQ_S_DONE}: Deallocated
DRLL IMSI-901700000004620_MSISDN-46071: Freeing RAN connection
DREF VLR subscr IMSI-901700000004620_MSISDN-46071 usage decreases to: 1
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_CM_SERVICE_REQ){RAN_CONN_S_RELEASED}: Freeing instance
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_CM_SERVICE_REQ){RAN_CONN_S_RELEASED}: Deallocated
  llist_count(&net->ran_conns) == 0
DREF freeing VLR subscr IMSI-901700000004620_MSISDN-46071
===== test_reject_paging_resp_during_cm: SUCCESS

full talloc report on 'msgb' (total      0 bytes in   1 blocks)
talloc_total_blocks(tall_bsc_ctx) == 13

===== test_reject_lu_during_paging_resp
---
- Subscriber does a normal LU
- Location Update Request
  MSC <--GERAN-A-- MS: GSM48_MT_MM_LOC_UPD_REQUEST
  new conn
DMM RAN_conn{RAN_CONN_S_NEW}: Allocated
DREF unknown: MSC conn use + compl_l3 == 1 (0x1: compl_l3)
DRLL Dispatching 04.08 message GSM48_MT_MM_LOC_UPD_REQUEST (0x5:0x8)
DMM RAN_conn(GERAN-A-0_unknown_LU){RAN_CONN_S_NEW}: Updated ID
DMM LOCATION UPDATING REQUEST: MI(IMSI)=901700000004620 type=IMSI ATTACH
DMM LU/new-LAC: 1/23
DVLR vlr_lu_fsm(GERAN-A-0_unknown_LU){VLR_ULA_S_IDLE}: Allocated
DVLR vlr_lu_fsm(GERAN-A-0_unknown_LU){VLR_ULA_S_IDLE}: is child of RAN_conn(GERAN-A-0_unknown_LU)
DVLR vlr_lu_fsm(GERAN-A-0_unknown_LU){VLR_ULA_S_IDLE}: rev=GSM net=GERAN (no Auth)
DVLR vlr_lu_fsm(GERAN-A-0_unknown_LU){VLR_ULA_S_IDLE}: Received Event VLR_ULA_E_UPDATE_LA
DREF VLR subscr unknown usage increases to: 1
DVLR set IMSI on subscriber; IMSI=901700000004620 id=901700000004620
DVLR New subscr, IMSI: 901700000004620
DREF VLR subscr IMSI-901700000004620 usage increases to: 2
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_LU){RAN_CONN_S_NEW}: Updated ID
DREF VLR subscr IMSI-901700000004620 usage decreases to: 1
DVLR vlr_lu_fsm(GERAN-A-0_IMSI-901700000004620_LU){VLR_ULA_S_IDLE}: vlr_loc_upd_node1()
DVLR vlr_lu_fsm(GERAN-A-0_IMSI-901700000004620_LU){VLR_ULA_S_IDLE}: vlr_loc_upd_post_auth()
DVLR vlr_lu_fsm(GERAN-A-0_IMSI-901700000004620_LU){VLR_ULA_S_IDLE}: vlr_loc_upd_post_ciph()
DVLR vlr_lu_fsm(GERAN-A-0_IMSI-901700000004620_LU){VLR_ULA_S_IDLE}: vlr_loc_upd_node_4()
DVLR vlr_lu_fsm(GERAN-A-0_IMSI-901700000004620_LU){VLR_ULA_S_IDLE}: state_chg to VLR_ULA_S_WAIT_HLR_UPD
DVLR upd_hlr_vlr_fsm(GERAN-A-0_IMSI-901700000004620_LU){UPD_HLR_VLR_S_INIT}: Allocated
DVLR upd_hlr_vlr_fsm(GERAN-A-0_IMSI-901700000004620_LU){UPD_HLR_VLR_S_INIT}: is child of vlr_lu_fsm(GERAN-A-0_IMSI-901700000004620_LU)
DVLR upd_hlr_vlr_fsm(GERAN-A-0_IMSI-901700000004620_LU){UPD_HLR_VLR_S_INIT}: Received Event UPD_HLR_VLR_E_START
DVLR GSUP tx: 04010809710000004026f0280102290101
GSUP --> HLR: OSMO_GSUP_MSGT_UPDATE_LOCATION_REQUEST: 04010809710000004026f0280102290101
DVLR upd_hlr_vlr_fsm(GERAN-A-0_IMSI-901700000004620_LU){UPD_HLR_VLR_S_INIT}: state_chg to UPD_HLR_VLR_S_WAIT_FOR_DATA
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_LU){RAN_CONN_S_NEW}: Received Event RAN_CONN_E_COMPLETE_LAYER_3
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_LU){RAN_CONN_S_NEW}: state_chg to RAN_CONN_S_AUTH_CIPH
DREF IMSI-901700000004620: MSC conn use - compl_l3 == 0 (0x0: )
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_LU){RAN_CONN_S_AUTH_CIPH}: Received Event RAN_CONN_E_UNUSED
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_LU){RAN_CONN_S_AUTH_CIPH}: Awaiting results for Auth+Ciph, overruling event RAN_CONN_E_UNUSED
  lu_result_sent == 0
  llist_count(&net->ran_conns) == 1
- HLR sends _INSERT_DATA_REQUEST, VLR responds with _INSERT_DATA_RESULT
<-- GSUP rx OSMO_GSUP_MSGT_INSERT_DATA_REQUEST: 10010809710000004026f00804036470f1
DVLR GSUP rx 17: 10010809710000004026f00804036470f1
DREF VLR subscr IMSI-901700000004620 usage increases to: 2
DVLR IMSI:901700000004620 has MSISDN:46071
DVLR SUBSCR(IMSI-901700000004620_MSISDN-46071) VLR: update for IMSI=901700000004620 (MSISDN=46071, used=2)
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){RAN_CONN_S_AUTH_CIPH}: Updated ID
DVLR GSUP tx: 12010809710000004026f0
GSUP --> HLR: OSMO_GSUP_MSGT_INSERT_DATA_RESULT: 12010809710000004026f0
DREF VLR subscr IMSI-901700000004620_MSISDN-46071 usage decreases to: 1
<-- GSUP rx OSMO_GSUP_MSGT_INSERT_DATA_REQUEST: vlr_gsupc_read_cb() returns 0
  lu_result_sent == 0
- HLR also sends GSUP _UPDATE_LOCATION_RESULT
<-- GSUP rx OSMO_GSUP_MSGT_UPDATE_LOCATION_RESULT: 06010809710000004026f0
DVLR GSUP rx 11: 06010809710000004026f0
DREF VLR subscr IMSI-901700000004620_MSISDN-46071 usage increases to: 2
DVLR vlr_lu_fsm(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){VLR_ULA_S_WAIT_HLR_UPD}: Received Event VLR_ULA_E_HLR_LU_RES
DVLR upd_hlr_vlr_fsm(GERAN-A-0_IMSI-901700000004620_LU){UPD_HLR_VLR_S_WAIT_FOR_DATA}: Received Event UPD_HLR_VLR_E_UPD_LOC_ACK
DVLR upd_hlr_vlr_fsm(GERAN-A-0_IMSI-901700000004620_LU){UPD_HLR_VLR_S_WAIT_FOR_DATA}: state_chg to UPD_HLR_VLR_S_DONE
DVLR upd_hlr_vlr_fsm(GERAN-A-0_IMSI-901700000004620_LU){UPD_HLR_VLR_S_DONE}: Terminating (cause = OSMO_FSM_TERM_REGULAR)
DVLR upd_hlr_vlr_fsm(GERAN-A-0_IMSI-901700000004620_LU){UPD_HLR_VLR_S_DONE}: Removing from parent vlr_lu_fsm(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU)
DVLR upd_hlr_vlr_fsm(GERAN-A-0_IMSI-901700000004620_LU){UPD_HLR_VLR_S_DONE}: Freeing instance
DVLR upd_hlr_vlr_fsm(GERAN-A-0_IMSI-901700000004620_LU){UPD_HLR_VLR_S_DONE}: Deallocated
DVLR vlr_lu_fsm(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){VLR_ULA_S_WAIT_HLR_UPD}: Received Event VLR_ULA_E_UPD_HLR_COMPL
DVLR vlr_lu_fsm(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){VLR_ULA_S_WAIT_HLR_UPD}: state_chg to VLR_ULA_S_WAIT_LU_COMPL
DVLR lu_compl_vlr_fsm(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){LU_COMPL_VLR_S_INIT}: Allocated
DVLR lu_compl_vlr_fsm(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){LU_COMPL_VLR_S_INIT}: is child of vlr_lu_fsm(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU)
DVLR lu_compl_vlr_fsm(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){LU_COMPL_VLR_S_INIT}: Received Event LU_COMPL_VLR_E_START
DVLR lu_compl_vlr_fsm(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){LU_COMPL_VLR_S_INIT}: state_chg to LU_COMPL_VLR_S_WAIT_SUB_PRES
DVLR lu_compl_vlr_fsm(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){LU_COMPL_VLR_S_WAIT_SUB_PRES}: Received Event LU_COMPL_VLR_E_SUB_PRES_COMPL
- sending LU Accept for IMSI-901700000004620_MSISDN-46071
DREF VLR subscr IMSI-901700000004620_MSISDN-46071 usage increases to: 3
DVLR lu_compl_vlr_fsm(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){LU_COMPL_VLR_S_WAIT_SUB_PRES}: state_chg to LU_COMPL_VLR_S_DONE
DVLR vlr_lu_fsm(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){VLR_ULA_S_WAIT_LU_COMPL}: Received Event VLR_ULA_E_LU_COMPL_SUCCESS
DVLR lu_compl_vlr_fsm(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){LU_COMPL_VLR_S_DONE}: Terminating (cause = OSMO_FSM_TERM_PARENT)
DVLR lu_compl_vlr_fsm(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){LU_COMPL_VLR_S_DONE}: Removing from parent vlr_lu_fsm(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU)
DVLR lu_compl_vlr_fsm(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){LU_COMPL_VLR_S_DONE}: Freeing instance
DVLR lu_compl_vlr_fsm(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){LU_COMPL_VLR_S_DONE}: Deallocated
DVLR vlr_lu_fsm(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){VLR_ULA_S_WAIT_LU_COMPL}: state_chg to VLR_ULA_S_DONE
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){RAN_CONN_S_AUTH_CIPH}: Received Event RAN_CONN_E_ACCEPTED
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){RAN_CONN_S_AUTH_CIPH}: state_chg to RAN_CONN_S_ACCEPTED
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){RAN_CONN_S_ACCEPTED}: Received Event RAN_CONN_E_UNUSED
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){RAN_CONN_S_ACCEPTED}: state_chg to RAN_CONN_S_RELEASING
DREF IMSI-901700000004620_MSISDN-46071: MSC conn use + release == 1 (0x100: release)
DREF VLR subscr IMSI-901700000004620_MSISDN-46071 usage increases to: 4
DREF VLR subscr IMSI-901700000004620_MSISDN-46071 usage decreases to: 3
- BSSAP Clear --GERAN-A--> MS
DREF VLR subscr IMSI-901700000004620_MSISDN-46071 usage decreases to: 2
<-- GSUP rx OSMO_GSUP_MSGT_UPDATE_LOCATION_RESULT: vlr_gsupc_read_cb() returns 0
  bssap_clear_sent == 1
- LU was successful, and the conn has already been closed
  lu_result_sent == 1
- BSS sends BSSMAP Clear Complete
DREF IMSI-901700000004620_MSISDN-46071: MSC conn use - release == 0 (0x0: )
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){RAN_CONN_S_RELEASING}: Received Event RAN_CONN_E_UNUSED
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){RAN_CONN_S_RELEASING}: state_chg to RAN_CONN_S_RELEASED
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){RAN_CONN_S_RELEASED}: Terminating (cause = OSMO_FSM_TERM_REGULAR)
DVLR vlr_lu_fsm(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){VLR_ULA_S_DONE}: Terminating (cause = OSMO_FSM_TERM_PARENT)
DVLR vlr_lu_fsm(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){VLR_ULA_S_DONE}: Removing from parent RAN_conn(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU)
DVLR vlr_lu_fsm(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){VLR_ULA_S_DONE}: fsm_lu_cleanup called with cause OSMO_FSM_TERM_PARENT
DVLR vlr_lu_fsm(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){VLR_ULA_S_DONE}: Freeing instance
DVLR vlr_lu_fsm(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){VLR_ULA_S_DONE}: Deallocated
DRLL IMSI-901700000004620_MSISDN-46071: Freeing RAN connection
DREF VLR subscr IMSI-901700000004620_MSISDN-46071 usage decreases to: 1
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){RAN_CONN_S_RELEASED}: Freeing instance
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){RAN_CONN_S_RELEASED}: Deallocated
  llist_count(&net->ran_conns) == 0
---
- an SMS is sent, MS is paged
DREF VLR subscr IMSI-901700000004620_MSISDN-46071 usage increases to: 2
  llist_count(&vsub->cs.requests) == 0
DREF VLR subscr IMSI-901700000004620_MSISDN-46071 usage increases to: 3
DCC (ti 00 sub IMSI-901700000004620_MSISDN-46071 callref 40000001) New transaction
DREF VLR subscr IMSI-901700000004620_MSISDN-46071 usage increases to: 4
DMM Subscriber IMSI-901700000004620_MSISDN-46071 not paged yet, start paging.
  GERAN-A sends out paging request to IMSI 901700000004620, TMSI 0xffffffff, LAC 23
  strcmp(paging_expecting_imsi, imsi) == 0
DREF VLR subscr IMSI-901700000004620_MSISDN-46071 usage increases to: 5
  llist_count(&vsub->cs.requests) == 1
DREF VLR subscr IMSI-901700000004620_MSISDN-46071 usage decreases to: 4
  paging_sent == 1
  paging_stopped == 0
- MS replies with Paging Response, we deliver the SMS
  MSC <--GERAN-A-- MS: GSM48_MT_RR_PAG_RESP
  new conn
DMM RAN_conn{RAN_CONN_S_NEW}: Allocated
DREF unknown: MSC conn use + compl_l3 == 1 (0x1: compl_l3)
DRLL Dispatching 04.08 message GSM48_MT_RR_PAG_RESP (0x6:0x27)
DRR PAGING RESPONSE: MI(IMSI)=901700000004620
DMM RAN_conn(GERAN-A-0_unknown_PAGING_RESP){RAN_CONN_S_NEW}: Updated ID
DVLR Process_Access_Request_VLR(GERAN-A-0_unknown_PAGING_RESP){PR_ARQ_S_INIT}: Allocated
DVLR Process_Access_Request_VLR(GERAN-A-0_unknown_PAGING_RESP){PR_ARQ_S_INIT}: is child of RAN_conn(GERAN-A-0_unknown_PAGING_RESP)
DVLR Process_Access_Request_VLR(GERAN-A-0_unknown_PAGING_RESP){PR_ARQ_S_INIT}: rev=GSM net=GERAN (no Auth)
DVLR Process_Access_Request_VLR(GERAN-A-0_unknown_PAGING_RESP){PR_ARQ_S_INIT}: Received Event PR_ARQ_E_START
DREF VLR subscr IMSI-901700000004620_MSISDN-46071 usage increases to: 5
DREF VLR subscr IMSI-901700000004620_MSISDN-46071 usage increases to: 6
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_PAGING_RESP){RAN_CONN_S_NEW}: Updated ID
DVLR Process_Access_Request_VLR(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_PAGING_RESP){PR_ARQ_S_INIT}: proc_arq_vlr_fn_post_imsi()
DVLR Process_Access_Request_VLR(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_PAGING_RESP){PR_ARQ_S_INIT}: _proc_arq_vlr_node2()
DVLR Process_Access_Request_VLR(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_PAGING_RESP){PR_ARQ_S_INIT}: _proc_arq_vlr_node2_post_ciph()
DVLR Process_Access_Request_VLR(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_PAGING_RESP){PR_ARQ_S_INIT}: _proc_arq_vlr_node2_post_vlr()
DVLR Process_Access_Request_VLR(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_PAGING_RESP){PR_ARQ_S_INIT}: _proc_arq_vlr_post_pres()
DVLR Process_Access_Request_VLR(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_PAGING_RESP){PR_ARQ_S_INIT}: _proc_arq_vlr_post_trace()
DVLR Process_Access_Request_VLR(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_PAGING_RESP){PR_ARQ_S_INIT}: _proc_arq_vlr_post_imei()
DVLR Process_Access_Request_VLR(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_PAGING_RESP){PR_ARQ_S_INIT}: proc_arq_fsm_done(PASSED)
DVLR Process_Access_Request_VLR(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_PAGING_RESP){PR_ARQ_S_INIT}: state_chg to PR_ARQ_S_DONE
DVLR Process_Access_Request_VLR(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_PAGING_RESP){PR_ARQ_S_DONE}: Process Access Request result: PASSED
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_PAGING_RESP){RAN_CONN_S_NEW}: Received Event RAN_CONN_E_ACCEPTED
DPAG Paging success for IMSI-901700000004620_MSISDN-46071 (event=0)
DPAG Calling paging cbfn.
DREF IMSI-901700000004620_MSISDN-46071: MSC conn use + trans_sms == 2 (0x21: compl_l3,trans_sms)
DMSC msc_tx 91 bytes to IMSI-901700000004620_MSISDN-46071 via GERAN-A
- DTAP --GERAN-A--> MS: SMS:0x01: 09015801000791447758100650004c0005806470f1000007101000000000445079da1e1ee7416937485e9ea7c965373d1d6683c270383b3d0ed3d36ff71c949e83c22072799e9687c5ec32a81d96afcbf4b4fb0c7ac3e9e9b7db05
- DTAP matches expected message
DREF VLR subscr IMSI-901700000004620_MSISDN-46071 usage decreases to: 5
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_PAGING_RESP){RAN_CONN_S_NEW}: state_chg to RAN_CONN_S_ACCEPTED
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_PAGING_RESP){RAN_CONN_S_ACCEPTED}: ran_conn_fsm_has_active_transactions: connection still has active transaction: SMS
DREF VLR subscr IMSI-901700000004620_MSISDN-46071 usage decreases to: 4
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_PAGING_RESP){RAN_CONN_S_ACCEPTED}: Received Event RAN_CONN_E_COMPLETE_LAYER_3
DREF IMSI-901700000004620_MSISDN-46071: MSC conn use - compl_l3 == 1 (0x20: trans_sms)
  dtap_tx_confirmed == 1
  paging_stopped == 1
- conn is still open to wait for SMS ack dance
  llist_count(&net->ran_conns) == 1
---
- MS sends erratic LU Request, which is dropped silently
  MSC <--GERAN-A-- MS: GSM48_MT_MM_LOC_UPD_REQUEST
DREF IMSI-901700000004620_MSISDN-46071: MSC conn use + dtap == 2 (0x22: dtap,trans_sms)
DRLL Dispatching 04.08 message GSM48_MT_MM_LOC_UPD_REQUEST (0x5:0x8)
DMM Cannot accept another LU, conn already established; extraneous LOCATION UPDATING REQUEST: MI(IMSI)=901700000004620 type=IMSI ATTACH
DREF IMSI-901700000004620_MSISDN-46071: MSC conn use - dtap == 1 (0x20: trans_sms)
  lu_result_sent == 0
  llist_count(&net->ran_conns) == 1
- MS replies with CP-ACK for received SMS
  MSC <--GERAN-A-- MS: SMS:0x04
DREF IMSI-901700000004620_MSISDN-46071: MSC conn use + dtap == 2 (0x22: dtap,trans_sms)
DRLL Dispatching 04.08 message SMS:0x04 (0x9:0x4)
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_PAGING_RESP){RAN_CONN_S_ACCEPTED}: Received Event RAN_CONN_E_COMMUNICATING
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_PAGING_RESP){RAN_CONN_S_ACCEPTED}: state_chg to RAN_CONN_S_COMMUNICATING
DREF IMSI-901700000004620_MSISDN-46071: MSC conn use - dtap == 1 (0x20: trans_sms)
  llist_count(&net->ran_conns) == 1
- MS also sends RP-ACK, MSC in turn sends CP-ACK for that
  MSC <--GERAN-A-- MS: SMS:0x01
DREF IMSI-901700000004620_MSISDN-46071: MSC conn use + dtap == 2 (0x22: dtap,trans_sms)
DRLL Dispatching 04.08 message SMS:0x01 (0x9:0x1)
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_PAGING_RESP){RAN_CONN_S_COMMUNICATING}: Received Event RAN_CONN_E_COMMUNICATING
DMSC msc_tx 2 bytes to IMSI-901700000004620_MSISDN-46071 via GERAN-A
- DTAP --GERAN-A--> MS: SMS:0x04: 0904
- DTAP matches expected message
DREF VLR subscr IMSI-901700000004620_MSISDN-46071 usage decreases to: 3
DREF VLR subscr IMSI-901700000004620_MSISDN-46071 usage decreases to: 2
DREF IMSI-901700000004620_MSISDN-46071: MSC conn use - trans_sms == 1 (0x2: dtap)
DREF IMSI-901700000004620_MSISDN-46071: MSC conn use - dtap == 0 (0x0: )
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_PAGING_RESP){RAN_CONN_S_COMMUNICATING}: Received Event RAN_CONN_E_UNUSED
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_PAGING_RESP){RAN_CONN_S_COMMUNICATING}: state_chg to RAN_CONN_S_RELEASING
DREF IMSI-901700000004620_MSISDN-46071: MSC conn use + release == 1 (0x100: release)
DREF VLR subscr IMSI-901700000004620_MSISDN-46071 usage increases to: 3
DREF VLR subscr IMSI-901700000004620_MSISDN-46071 usage decreases to: 2
- BSSAP Clear --GERAN-A--> MS
  dtap_tx_confirmed == 1
  bssap_clear_sent == 1
- BSS sends BSSMAP Clear Complete
DREF IMSI-901700000004620_MSISDN-46071: MSC conn use - release == 0 (0x0: )
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_PAGING_RESP){RAN_CONN_S_RELEASING}: Received Event RAN_CONN_E_UNUSED
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_PAGING_RESP){RAN_CONN_S_RELEASING}: state_chg to RAN_CONN_S_RELEASED
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_PAGING_RESP){RAN_CONN_S_RELEASED}: Terminating (cause = OSMO_FSM_TERM_REGULAR)
DVLR Process_Access_Request_VLR(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_PAGING_RESP){PR_ARQ_S_DONE}: Terminating (cause = OSMO_FSM_TERM_PARENT)
DVLR Process_Access_Request_VLR(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_PAGING_RESP){PR_ARQ_S_DONE}: Removing from parent RAN_conn(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_PAGING_RESP)
DVLR Process_Access_Request_VLR(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_PAGING_RESP){PR_ARQ_S_DONE}: Freeing instance
DVLR Process_Access_Request_VLR(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_PAGING_RESP){PR_ARQ_S_DONE}: Deallocated
DRLL IMSI-901700000004620_MSISDN-46071: Freeing RAN connection
DREF VLR subscr IMSI-901700000004620_MSISDN-46071 usage decreases to: 1
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_PAGING_RESP){RAN_CONN_S_RELEASED}: Freeing instance
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_PAGING_RESP){RAN_CONN_S_RELEASED}: Deallocated
- SMS is done
  llist_count(&net->ran_conns) == 0
DREF freeing VLR subscr IMSI-901700000004620_MSISDN-46071
===== test_reject_lu_during_paging_resp: SUCCESS

full talloc report on 'msgb' (total      0 bytes in   1 blocks)
talloc_total_blocks(tall_bsc_ctx) == 13

===== test_accept_cm_during_paging_resp
---
- Subscriber does a normal LU
- Location Update Request
  MSC <--GERAN-A-- MS: GSM48_MT_MM_LOC_UPD_REQUEST
  new conn
DMM RAN_conn{RAN_CONN_S_NEW}: Allocated
DREF unknown: MSC conn use + compl_l3 == 1 (0x1: compl_l3)
DRLL Dispatching 04.08 message GSM48_MT_MM_LOC_UPD_REQUEST (0x5:0x8)
DMM RAN_conn(GERAN-A-0_unknown_LU){RAN_CONN_S_NEW}: Updated ID
DMM LOCATION UPDATING REQUEST: MI(IMSI)=901700000004620 type=IMSI ATTACH
DMM LU/new-LAC: 1/23
DVLR vlr_lu_fsm(GERAN-A-0_unknown_LU){VLR_ULA_S_IDLE}: Allocated
DVLR vlr_lu_fsm(GERAN-A-0_unknown_LU){VLR_ULA_S_IDLE}: is child of RAN_conn(GERAN-A-0_unknown_LU)
DVLR vlr_lu_fsm(GERAN-A-0_unknown_LU){VLR_ULA_S_IDLE}: rev=GSM net=GERAN (no Auth)
DVLR vlr_lu_fsm(GERAN-A-0_unknown_LU){VLR_ULA_S_IDLE}: Received Event VLR_ULA_E_UPDATE_LA
DREF VLR subscr unknown usage increases to: 1
DVLR set IMSI on subscriber; IMSI=901700000004620 id=901700000004620
DVLR New subscr, IMSI: 901700000004620
DREF VLR subscr IMSI-901700000004620 usage increases to: 2
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_LU){RAN_CONN_S_NEW}: Updated ID
DREF VLR subscr IMSI-901700000004620 usage decreases to: 1
DVLR vlr_lu_fsm(GERAN-A-0_IMSI-901700000004620_LU){VLR_ULA_S_IDLE}: vlr_loc_upd_node1()
DVLR vlr_lu_fsm(GERAN-A-0_IMSI-901700000004620_LU){VLR_ULA_S_IDLE}: vlr_loc_upd_post_auth()
DVLR vlr_lu_fsm(GERAN-A-0_IMSI-901700000004620_LU){VLR_ULA_S_IDLE}: vlr_loc_upd_post_ciph()
DVLR vlr_lu_fsm(GERAN-A-0_IMSI-901700000004620_LU){VLR_ULA_S_IDLE}: vlr_loc_upd_node_4()
DVLR vlr_lu_fsm(GERAN-A-0_IMSI-901700000004620_LU){VLR_ULA_S_IDLE}: state_chg to VLR_ULA_S_WAIT_HLR_UPD
DVLR upd_hlr_vlr_fsm(GERAN-A-0_IMSI-901700000004620_LU){UPD_HLR_VLR_S_INIT}: Allocated
DVLR upd_hlr_vlr_fsm(GERAN-A-0_IMSI-901700000004620_LU){UPD_HLR_VLR_S_INIT}: is child of vlr_lu_fsm(GERAN-A-0_IMSI-901700000004620_LU)
DVLR upd_hlr_vlr_fsm(GERAN-A-0_IMSI-901700000004620_LU){UPD_HLR_VLR_S_INIT}: Received Event UPD_HLR_VLR_E_START
DVLR GSUP tx: 04010809710000004026f0280102290101
GSUP --> HLR: OSMO_GSUP_MSGT_UPDATE_LOCATION_REQUEST: 04010809710000004026f0280102290101
DVLR upd_hlr_vlr_fsm(GERAN-A-0_IMSI-901700000004620_LU){UPD_HLR_VLR_S_INIT}: state_chg to UPD_HLR_VLR_S_WAIT_FOR_DATA
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_LU){RAN_CONN_S_NEW}: Received Event RAN_CONN_E_COMPLETE_LAYER_3
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_LU){RAN_CONN_S_NEW}: state_chg to RAN_CONN_S_AUTH_CIPH
DREF IMSI-901700000004620: MSC conn use - compl_l3 == 0 (0x0: )
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_LU){RAN_CONN_S_AUTH_CIPH}: Received Event RAN_CONN_E_UNUSED
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_LU){RAN_CONN_S_AUTH_CIPH}: Awaiting results for Auth+Ciph, overruling event RAN_CONN_E_UNUSED
  lu_result_sent == 0
  llist_count(&net->ran_conns) == 1
- HLR sends _INSERT_DATA_REQUEST, VLR responds with _INSERT_DATA_RESULT
<-- GSUP rx OSMO_GSUP_MSGT_INSERT_DATA_REQUEST: 10010809710000004026f00804036470f1
DVLR GSUP rx 17: 10010809710000004026f00804036470f1
DREF VLR subscr IMSI-901700000004620 usage increases to: 2
DVLR IMSI:901700000004620 has MSISDN:46071
DVLR SUBSCR(IMSI-901700000004620_MSISDN-46071) VLR: update for IMSI=901700000004620 (MSISDN=46071, used=2)
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){RAN_CONN_S_AUTH_CIPH}: Updated ID
DVLR GSUP tx: 12010809710000004026f0
GSUP --> HLR: OSMO_GSUP_MSGT_INSERT_DATA_RESULT: 12010809710000004026f0
DREF VLR subscr IMSI-901700000004620_MSISDN-46071 usage decreases to: 1
<-- GSUP rx OSMO_GSUP_MSGT_INSERT_DATA_REQUEST: vlr_gsupc_read_cb() returns 0
  lu_result_sent == 0
- HLR also sends GSUP _UPDATE_LOCATION_RESULT
<-- GSUP rx OSMO_GSUP_MSGT_UPDATE_LOCATION_RESULT: 06010809710000004026f0
DVLR GSUP rx 11: 06010809710000004026f0
DREF VLR subscr IMSI-901700000004620_MSISDN-46071 usage increases to: 2
DVLR vlr_lu_fsm(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){VLR_ULA_S_WAIT_HLR_UPD}: Received Event VLR_ULA_E_HLR_LU_RES
DVLR upd_hlr_vlr_fsm(GERAN-A-0_IMSI-901700000004620_LU){UPD_HLR_VLR_S_WAIT_FOR_DATA}: Received Event UPD_HLR_VLR_E_UPD_LOC_ACK
DVLR upd_hlr_vlr_fsm(GERAN-A-0_IMSI-901700000004620_LU){UPD_HLR_VLR_S_WAIT_FOR_DATA}: state_chg to UPD_HLR_VLR_S_DONE
DVLR upd_hlr_vlr_fsm(GERAN-A-0_IMSI-901700000004620_LU){UPD_HLR_VLR_S_DONE}: Terminating (cause = OSMO_FSM_TERM_REGULAR)
DVLR upd_hlr_vlr_fsm(GERAN-A-0_IMSI-901700000004620_LU){UPD_HLR_VLR_S_DONE}: Removing from parent vlr_lu_fsm(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU)
DVLR upd_hlr_vlr_fsm(GERAN-A-0_IMSI-901700000004620_LU){UPD_HLR_VLR_S_DONE}: Freeing instance
DVLR upd_hlr_vlr_fsm(GERAN-A-0_IMSI-901700000004620_LU){UPD_HLR_VLR_S_DONE}: Deallocated
DVLR vlr_lu_fsm(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){VLR_ULA_S_WAIT_HLR_UPD}: Received Event VLR_ULA_E_UPD_HLR_COMPL
DVLR vlr_lu_fsm(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){VLR_ULA_S_WAIT_HLR_UPD}: state_chg to VLR_ULA_S_WAIT_LU_COMPL
DVLR lu_compl_vlr_fsm(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){LU_COMPL_VLR_S_INIT}: Allocated
DVLR lu_compl_vlr_fsm(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){LU_COMPL_VLR_S_INIT}: is child of vlr_lu_fsm(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU)
DVLR lu_compl_vlr_fsm(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){LU_COMPL_VLR_S_INIT}: Received Event LU_COMPL_VLR_E_START
DVLR lu_compl_vlr_fsm(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){LU_COMPL_VLR_S_INIT}: state_chg to LU_COMPL_VLR_S_WAIT_SUB_PRES
DVLR lu_compl_vlr_fsm(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){LU_COMPL_VLR_S_WAIT_SUB_PRES}: Received Event LU_COMPL_VLR_E_SUB_PRES_COMPL
- sending LU Accept for IMSI-901700000004620_MSISDN-46071
DREF VLR subscr IMSI-901700000004620_MSISDN-46071 usage increases to: 3
DVLR lu_compl_vlr_fsm(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){LU_COMPL_VLR_S_WAIT_SUB_PRES}: state_chg to LU_COMPL_VLR_S_DONE
DVLR vlr_lu_fsm(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){VLR_ULA_S_WAIT_LU_COMPL}: Received Event VLR_ULA_E_LU_COMPL_SUCCESS
DVLR lu_compl_vlr_fsm(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){LU_COMPL_VLR_S_DONE}: Terminating (cause = OSMO_FSM_TERM_PARENT)
DVLR lu_compl_vlr_fsm(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){LU_COMPL_VLR_S_DONE}: Removing from parent vlr_lu_fsm(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU)
DVLR lu_compl_vlr_fsm(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){LU_COMPL_VLR_S_DONE}: Freeing instance
DVLR lu_compl_vlr_fsm(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){LU_COMPL_VLR_S_DONE}: Deallocated
DVLR vlr_lu_fsm(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){VLR_ULA_S_WAIT_LU_COMPL}: state_chg to VLR_ULA_S_DONE
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){RAN_CONN_S_AUTH_CIPH}: Received Event RAN_CONN_E_ACCEPTED
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){RAN_CONN_S_AUTH_CIPH}: state_chg to RAN_CONN_S_ACCEPTED
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){RAN_CONN_S_ACCEPTED}: Received Event RAN_CONN_E_UNUSED
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){RAN_CONN_S_ACCEPTED}: state_chg to RAN_CONN_S_RELEASING
DREF IMSI-901700000004620_MSISDN-46071: MSC conn use + release == 1 (0x100: release)
DREF VLR subscr IMSI-901700000004620_MSISDN-46071 usage increases to: 4
DREF VLR subscr IMSI-901700000004620_MSISDN-46071 usage decreases to: 3
- BSSAP Clear --GERAN-A--> MS
DREF VLR subscr IMSI-901700000004620_MSISDN-46071 usage decreases to: 2
<-- GSUP rx OSMO_GSUP_MSGT_UPDATE_LOCATION_RESULT: vlr_gsupc_read_cb() returns 0
  bssap_clear_sent == 1
- LU was successful, and the conn has already been closed
  lu_result_sent == 1
- BSS sends BSSMAP Clear Complete
DREF IMSI-901700000004620_MSISDN-46071: MSC conn use - release == 0 (0x0: )
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){RAN_CONN_S_RELEASING}: Received Event RAN_CONN_E_UNUSED
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){RAN_CONN_S_RELEASING}: state_chg to RAN_CONN_S_RELEASED
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){RAN_CONN_S_RELEASED}: Terminating (cause = OSMO_FSM_TERM_REGULAR)
DVLR vlr_lu_fsm(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){VLR_ULA_S_DONE}: Terminating (cause = OSMO_FSM_TERM_PARENT)
DVLR vlr_lu_fsm(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){VLR_ULA_S_DONE}: Removing from parent RAN_conn(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU)
DVLR vlr_lu_fsm(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){VLR_ULA_S_DONE}: fsm_lu_cleanup called with cause OSMO_FSM_TERM_PARENT
DVLR vlr_lu_fsm(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){VLR_ULA_S_DONE}: Freeing instance
DVLR vlr_lu_fsm(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){VLR_ULA_S_DONE}: Deallocated
DRLL IMSI-901700000004620_MSISDN-46071: Freeing RAN connection
DREF VLR subscr IMSI-901700000004620_MSISDN-46071 usage decreases to: 1
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){RAN_CONN_S_RELEASED}: Freeing instance
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){RAN_CONN_S_RELEASED}: Deallocated
  llist_count(&net->ran_conns) == 0
---
- an SMS is sent, MS is paged
DREF VLR subscr IMSI-901700000004620_MSISDN-46071 usage increases to: 2
  llist_count(&vsub->cs.requests) == 0
DREF VLR subscr IMSI-901700000004620_MSISDN-46071 usage increases to: 3
DCC (ti 00 sub IMSI-901700000004620_MSISDN-46071 callref 40000002) New transaction
DREF VLR subscr IMSI-901700000004620_MSISDN-46071 usage increases to: 4
DMM Subscriber IMSI-901700000004620_MSISDN-46071 not paged yet, start paging.
  GERAN-A sends out paging request to IMSI 901700000004620, TMSI 0xffffffff, LAC 23
  strcmp(paging_expecting_imsi, imsi) == 0
DREF VLR subscr IMSI-901700000004620_MSISDN-46071 usage increases to: 5
  llist_count(&vsub->cs.requests) == 1
DREF VLR subscr IMSI-901700000004620_MSISDN-46071 usage decreases to: 4
  paging_sent == 1
  paging_stopped == 0
- MS replies with Paging Response, we deliver the SMS
  MSC <--GERAN-A-- MS: GSM48_MT_RR_PAG_RESP
  new conn
DMM RAN_conn{RAN_CONN_S_NEW}: Allocated
DREF unknown: MSC conn use + compl_l3 == 1 (0x1: compl_l3)
DRLL Dispatching 04.08 message GSM48_MT_RR_PAG_RESP (0x6:0x27)
DRR PAGING RESPONSE: MI(IMSI)=901700000004620
DMM RAN_conn(GERAN-A-0_unknown_PAGING_RESP){RAN_CONN_S_NEW}: Updated ID
DVLR Process_Access_Request_VLR(GERAN-A-0_unknown_PAGING_RESP){PR_ARQ_S_INIT}: Allocated
DVLR Process_Access_Request_VLR(GERAN-A-0_unknown_PAGING_RESP){PR_ARQ_S_INIT}: is child of RAN_conn(GERAN-A-0_unknown_PAGING_RESP)
DVLR Process_Access_Request_VLR(GERAN-A-0_unknown_PAGING_RESP){PR_ARQ_S_INIT}: rev=GSM net=GERAN (no Auth)
DVLR Process_Access_Request_VLR(GERAN-A-0_unknown_PAGING_RESP){PR_ARQ_S_INIT}: Received Event PR_ARQ_E_START
DREF VLR subscr IMSI-901700000004620_MSISDN-46071 usage increases to: 5
DREF VLR subscr IMSI-901700000004620_MSISDN-46071 usage increases to: 6
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_PAGING_RESP){RAN_CONN_S_NEW}: Updated ID
DVLR Process_Access_Request_VLR(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_PAGING_RESP){PR_ARQ_S_INIT}: proc_arq_vlr_fn_post_imsi()
DVLR Process_Access_Request_VLR(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_PAGING_RESP){PR_ARQ_S_INIT}: _proc_arq_vlr_node2()
DVLR Process_Access_Request_VLR(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_PAGING_RESP){PR_ARQ_S_INIT}: _proc_arq_vlr_node2_post_ciph()
DVLR Process_Access_Request_VLR(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_PAGING_RESP){PR_ARQ_S_INIT}: _proc_arq_vlr_node2_post_vlr()
DVLR Process_Access_Request_VLR(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_PAGING_RESP){PR_ARQ_S_INIT}: _proc_arq_vlr_post_pres()
DVLR Process_Access_Request_VLR(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_PAGING_RESP){PR_ARQ_S_INIT}: _proc_arq_vlr_post_trace()
DVLR Process_Access_Request_VLR(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_PAGING_RESP){PR_ARQ_S_INIT}: _proc_arq_vlr_post_imei()
DVLR Process_Access_Request_VLR(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_PAGING_RESP){PR_ARQ_S_INIT}: proc_arq_fsm_done(PASSED)
DVLR Process_Access_Request_VLR(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_PAGING_RESP){PR_ARQ_S_INIT}: state_chg to PR_ARQ_S_DONE
DVLR Process_Access_Request_VLR(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_PAGING_RESP){PR_ARQ_S_DONE}: Process Access Request result: PASSED
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_PAGING_RESP){RAN_CONN_S_NEW}: Received Event RAN_CONN_E_ACCEPTED
DPAG Paging success for IMSI-901700000004620_MSISDN-46071 (event=0)
DPAG Calling paging cbfn.
DREF IMSI-901700000004620_MSISDN-46071: MSC conn use + trans_sms == 2 (0x21: compl_l3,trans_sms)
DMSC msc_tx 91 bytes to IMSI-901700000004620_MSISDN-46071 via GERAN-A
- DTAP --GERAN-A--> MS: SMS:0x01: 09015801000791447758100650004c0005806470f1000007101000000000445079da1e1ee7416937485e9ea7c965373d1d6683c270383b3d0ed3d36ff71c949e83c22072799e9687c5ec32a81d96afcbf4b4fb0c7ac3e9e9b7db05
- DTAP matches expected message
DREF VLR subscr IMSI-901700000004620_MSISDN-46071 usage decreases to: 5
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_PAGING_RESP){RAN_CONN_S_NEW}: state_chg to RAN_CONN_S_ACCEPTED
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_PAGING_RESP){RAN_CONN_S_ACCEPTED}: ran_conn_fsm_has_active_transactions: connection still has active transaction: SMS
DREF VLR subscr IMSI-901700000004620_MSISDN-46071 usage decreases to: 4
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_PAGING_RESP){RAN_CONN_S_ACCEPTED}: Received Event RAN_CONN_E_COMPLETE_LAYER_3
DREF IMSI-901700000004620_MSISDN-46071: MSC conn use - compl_l3 == 1 (0x20: trans_sms)
  dtap_tx_confirmed == 1
  paging_stopped == 1
- conn is still open to wait for SMS ack dance
  llist_count(&net->ran_conns) == 1
---
- CM Service Request during open connection is accepted
  MSC <--GERAN-A-- MS: GSM48_MT_MM_CM_SERV_REQ
DREF IMSI-901700000004620_MSISDN-46071: MSC conn use + dtap == 2 (0x22: dtap,trans_sms)
DRLL Dispatching 04.08 message GSM48_MT_MM_CM_SERV_REQ (0x5:0x24)
DMM <- CM SERVICE REQUEST serv_type=0x08 MI(IMSI)=901700000004620
DMM IMSI-901700000004620_MSISDN-46071: re-using already accepted connection
DREF IMSI-901700000004620_MSISDN-46071: MSC conn use + cm_service == 3 (0x2a: dtap,cm_service,trans_sms)
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_PAGING_RESP){RAN_CONN_S_ACCEPTED}: Updated ID
- sending CM Service Accept for IMSI-901700000004620_MSISDN-46071
DREF IMSI-901700000004620_MSISDN-46071: MSC conn use - dtap == 2 (0x28: cm_service,trans_sms)
  cm_service_result_sent == 1
  llist_count(&net->ran_conns) == 1
  g_conn->received_cm_service_request == 1
- MS replies with CP-ACK for received SMS
  MSC <--GERAN-A-- MS: SMS:0x04
DREF IMSI-901700000004620_MSISDN-46071: MSC conn use + dtap == 3 (0x2a: dtap,cm_service,trans_sms)
DRLL Dispatching 04.08 message SMS:0x04 (0x9:0x4)
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_PAGING_RESP){RAN_CONN_S_ACCEPTED}: Received Event RAN_CONN_E_COMMUNICATING
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_PAGING_RESP){RAN_CONN_S_ACCEPTED}: state_chg to RAN_CONN_S_COMMUNICATING
DREF IMSI-901700000004620_MSISDN-46071: MSC conn use - dtap == 2 (0x28: cm_service,trans_sms)
  llist_count(&net->ran_conns) == 1
- MS also sends RP-ACK, MSC in turn sends CP-ACK for that
  MSC <--GERAN-A-- MS: SMS:0x01
DREF IMSI-901700000004620_MSISDN-46071: MSC conn use + dtap == 3 (0x2a: dtap,cm_service,trans_sms)
DRLL Dispatching 04.08 message SMS:0x01 (0x9:0x1)
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_PAGING_RESP){RAN_CONN_S_COMMUNICATING}: Received Event RAN_CONN_E_COMMUNICATING
DMSC msc_tx 2 bytes to IMSI-901700000004620_MSISDN-46071 via GERAN-A
- DTAP --GERAN-A--> MS: SMS:0x04: 0904
- DTAP matches expected message
DREF VLR subscr IMSI-901700000004620_MSISDN-46071 usage decreases to: 3
DREF VLR subscr IMSI-901700000004620_MSISDN-46071 usage decreases to: 2
DREF IMSI-901700000004620_MSISDN-46071: MSC conn use - trans_sms == 2 (0xa: dtap,cm_service)
DREF IMSI-901700000004620_MSISDN-46071: MSC conn use - dtap == 1 (0x8: cm_service)
  dtap_tx_confirmed == 1
- SMS is done
  llist_count(&net->ran_conns) == 1
---
- subscriber detaches
  MSC <--GERAN-A-- MS: GSM48_MT_MM_IMSI_DETACH_IND
DREF IMSI-901700000004620_MSISDN-46071: MSC conn use + dtap == 2 (0xa: dtap,cm_service)
DRLL Dispatching 04.08 message GSM48_MT_MM_IMSI_DETACH_IND (0x5:0x1)
DMM IMSI DETACH INDICATION: MI(IMSI)=901700000004620
DREF VLR subscr IMSI-901700000004620_MSISDN-46071 usage increases to: 3
DMM IMSI DETACH for IMSI-901700000004620_MSISDN-46071
DREF VLR subscr IMSI-901700000004620_MSISDN-46071 usage increases to: 4
DREF VLR subscr IMSI-901700000004620_MSISDN-46071 usage decreases to: 3
DREF VLR subscr IMSI-901700000004620_MSISDN-46071 usage decreases to: 2
DREF VLR subscr IMSI-901700000004620_MSISDN-46071 usage decreases to: 1
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_PAGING_RESP){RAN_CONN_S_COMMUNICATING}: Received Event RAN_CONN_E_CN_CLOSE
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_PAGING_RESP){RAN_CONN_S_COMMUNICATING}: state_chg to RAN_CONN_S_RELEASING
DREF IMSI-901700000004620_MSISDN-46071: MSC conn use + release == 3 (0x10a: dtap,cm_service,release)
DREF IMSI-901700000004620_MSISDN-46071: MSC conn use - cm_service == 2 (0x102: dtap,release)
DREF VLR subscr IMSI-901700000004620_MSISDN-46071 usage increases to: 2
DREF VLR subscr IMSI-901700000004620_MSISDN-46071 usage decreases to: 1
- BSSAP Clear --GERAN-A--> MS
DREF IMSI-901700000004620_MSISDN-46071: MSC conn use - dtap == 1 (0x100: release)
  bssap_clear_sent == 1
- BSS sends BSSMAP Clear Complete
DREF IMSI-901700000004620_MSISDN-46071: MSC conn use - release == 0 (0x0: )
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_PAGING_RESP){RAN_CONN_S_RELEASING}: Received Event RAN_CONN_E_UNUSED
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_PAGING_RESP){RAN_CONN_S_RELEASING}: state_chg to RAN_CONN_S_RELEASED
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_PAGING_RESP){RAN_CONN_S_RELEASED}: Terminating (cause = OSMO_FSM_TERM_REGULAR)
DVLR Process_Access_Request_VLR(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_PAGING_RESP){PR_ARQ_S_DONE}: Terminating (cause = OSMO_FSM_TERM_PARENT)
DVLR Process_Access_Request_VLR(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_PAGING_RESP){PR_ARQ_S_DONE}: Removing from parent RAN_conn(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_PAGING_RESP)
DVLR Process_Access_Request_VLR(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_PAGING_RESP){PR_ARQ_S_DONE}: Freeing instance
DVLR Process_Access_Request_VLR(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_PAGING_RESP){PR_ARQ_S_DONE}: Deallocated
DRLL IMSI-901700000004620_MSISDN-46071: Freeing RAN connection
DREF VLR subscr IMSI-901700000004620_MSISDN-46071 usage decreases to: 0
DREF freeing VLR subscr IMSI-901700000004620_MSISDN-46071
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_PAGING_RESP){RAN_CONN_S_RELEASED}: Freeing instance
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_PAGING_RESP){RAN_CONN_S_RELEASED}: Deallocated
  llist_count(&net->ran_conns) == 0
===== test_accept_cm_during_paging_resp: SUCCESS

full talloc report on 'msgb' (total      0 bytes in   1 blocks)
talloc_total_blocks(tall_bsc_ctx) == 13

===== test_reject_paging_resp_during_paging_resp
---
- Subscriber does a normal LU
- Location Update Request
  MSC <--GERAN-A-- MS: GSM48_MT_MM_LOC_UPD_REQUEST
  new conn
DMM RAN_conn{RAN_CONN_S_NEW}: Allocated
DREF unknown: MSC conn use + compl_l3 == 1 (0x1: compl_l3)
DRLL Dispatching 04.08 message GSM48_MT_MM_LOC_UPD_REQUEST (0x5:0x8)
DMM RAN_conn(GERAN-A-0_unknown_LU){RAN_CONN_S_NEW}: Updated ID
DMM LOCATION UPDATING REQUEST: MI(IMSI)=901700000004620 type=IMSI ATTACH
DMM LU/new-LAC: 1/23
DVLR vlr_lu_fsm(GERAN-A-0_unknown_LU){VLR_ULA_S_IDLE}: Allocated
DVLR vlr_lu_fsm(GERAN-A-0_unknown_LU){VLR_ULA_S_IDLE}: is child of RAN_conn(GERAN-A-0_unknown_LU)
DVLR vlr_lu_fsm(GERAN-A-0_unknown_LU){VLR_ULA_S_IDLE}: rev=GSM net=GERAN (no Auth)
DVLR vlr_lu_fsm(GERAN-A-0_unknown_LU){VLR_ULA_S_IDLE}: Received Event VLR_ULA_E_UPDATE_LA
DREF VLR subscr unknown usage increases to: 1
DVLR set IMSI on subscriber; IMSI=901700000004620 id=901700000004620
DVLR New subscr, IMSI: 901700000004620
DREF VLR subscr IMSI-901700000004620 usage increases to: 2
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_LU){RAN_CONN_S_NEW}: Updated ID
DREF VLR subscr IMSI-901700000004620 usage decreases to: 1
DVLR vlr_lu_fsm(GERAN-A-0_IMSI-901700000004620_LU){VLR_ULA_S_IDLE}: vlr_loc_upd_node1()
DVLR vlr_lu_fsm(GERAN-A-0_IMSI-901700000004620_LU){VLR_ULA_S_IDLE}: vlr_loc_upd_post_auth()
DVLR vlr_lu_fsm(GERAN-A-0_IMSI-901700000004620_LU){VLR_ULA_S_IDLE}: vlr_loc_upd_post_ciph()
DVLR vlr_lu_fsm(GERAN-A-0_IMSI-901700000004620_LU){VLR_ULA_S_IDLE}: vlr_loc_upd_node_4()
DVLR vlr_lu_fsm(GERAN-A-0_IMSI-901700000004620_LU){VLR_ULA_S_IDLE}: state_chg to VLR_ULA_S_WAIT_HLR_UPD
DVLR upd_hlr_vlr_fsm(GERAN-A-0_IMSI-901700000004620_LU){UPD_HLR_VLR_S_INIT}: Allocated
DVLR upd_hlr_vlr_fsm(GERAN-A-0_IMSI-901700000004620_LU){UPD_HLR_VLR_S_INIT}: is child of vlr_lu_fsm(GERAN-A-0_IMSI-901700000004620_LU)
DVLR upd_hlr_vlr_fsm(GERAN-A-0_IMSI-901700000004620_LU){UPD_HLR_VLR_S_INIT}: Received Event UPD_HLR_VLR_E_START
DVLR GSUP tx: 04010809710000004026f0280102290101
GSUP --> HLR: OSMO_GSUP_MSGT_UPDATE_LOCATION_REQUEST: 04010809710000004026f0280102290101
DVLR upd_hlr_vlr_fsm(GERAN-A-0_IMSI-901700000004620_LU){UPD_HLR_VLR_S_INIT}: state_chg to UPD_HLR_VLR_S_WAIT_FOR_DATA
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_LU){RAN_CONN_S_NEW}: Received Event RAN_CONN_E_COMPLETE_LAYER_3
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_LU){RAN_CONN_S_NEW}: state_chg to RAN_CONN_S_AUTH_CIPH
DREF IMSI-901700000004620: MSC conn use - compl_l3 == 0 (0x0: )
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_LU){RAN_CONN_S_AUTH_CIPH}: Received Event RAN_CONN_E_UNUSED
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_LU){RAN_CONN_S_AUTH_CIPH}: Awaiting results for Auth+Ciph, overruling event RAN_CONN_E_UNUSED
  lu_result_sent == 0
  llist_count(&net->ran_conns) == 1
- HLR sends _INSERT_DATA_REQUEST, VLR responds with _INSERT_DATA_RESULT
<-- GSUP rx OSMO_GSUP_MSGT_INSERT_DATA_REQUEST: 10010809710000004026f00804036470f1
DVLR GSUP rx 17: 10010809710000004026f00804036470f1
DREF VLR subscr IMSI-901700000004620 usage increases to: 2
DVLR IMSI:901700000004620 has MSISDN:46071
DVLR SUBSCR(IMSI-901700000004620_MSISDN-46071) VLR: update for IMSI=901700000004620 (MSISDN=46071, used=2)
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){RAN_CONN_S_AUTH_CIPH}: Updated ID
DVLR GSUP tx: 12010809710000004026f0
GSUP --> HLR: OSMO_GSUP_MSGT_INSERT_DATA_RESULT: 12010809710000004026f0
DREF VLR subscr IMSI-901700000004620_MSISDN-46071 usage decreases to: 1
<-- GSUP rx OSMO_GSUP_MSGT_INSERT_DATA_REQUEST: vlr_gsupc_read_cb() returns 0
  lu_result_sent == 0
- HLR also sends GSUP _UPDATE_LOCATION_RESULT
<-- GSUP rx OSMO_GSUP_MSGT_UPDATE_LOCATION_RESULT: 06010809710000004026f0
DVLR GSUP rx 11: 06010809710000004026f0
DREF VLR subscr IMSI-901700000004620_MSISDN-46071 usage increases to: 2
DVLR vlr_lu_fsm(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){VLR_ULA_S_WAIT_HLR_UPD}: Received Event VLR_ULA_E_HLR_LU_RES
DVLR upd_hlr_vlr_fsm(GERAN-A-0_IMSI-901700000004620_LU){UPD_HLR_VLR_S_WAIT_FOR_DATA}: Received Event UPD_HLR_VLR_E_UPD_LOC_ACK
DVLR upd_hlr_vlr_fsm(GERAN-A-0_IMSI-901700000004620_LU){UPD_HLR_VLR_S_WAIT_FOR_DATA}: state_chg to UPD_HLR_VLR_S_DONE
DVLR upd_hlr_vlr_fsm(GERAN-A-0_IMSI-901700000004620_LU){UPD_HLR_VLR_S_DONE}: Terminating (cause = OSMO_FSM_TERM_REGULAR)
DVLR upd_hlr_vlr_fsm(GERAN-A-0_IMSI-901700000004620_LU){UPD_HLR_VLR_S_DONE}: Removing from parent vlr_lu_fsm(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU)
DVLR upd_hlr_vlr_fsm(GERAN-A-0_IMSI-901700000004620_LU){UPD_HLR_VLR_S_DONE}: Freeing instance
DVLR upd_hlr_vlr_fsm(GERAN-A-0_IMSI-901700000004620_LU){UPD_HLR_VLR_S_DONE}: Deallocated
DVLR vlr_lu_fsm(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){VLR_ULA_S_WAIT_HLR_UPD}: Received Event VLR_ULA_E_UPD_HLR_COMPL
DVLR vlr_lu_fsm(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){VLR_ULA_S_WAIT_HLR_UPD}: state_chg to VLR_ULA_S_WAIT_LU_COMPL
DVLR lu_compl_vlr_fsm(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){LU_COMPL_VLR_S_INIT}: Allocated
DVLR lu_compl_vlr_fsm(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){LU_COMPL_VLR_S_INIT}: is child of vlr_lu_fsm(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU)
DVLR lu_compl_vlr_fsm(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){LU_COMPL_VLR_S_INIT}: Received Event LU_COMPL_VLR_E_START
DVLR lu_compl_vlr_fsm(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){LU_COMPL_VLR_S_INIT}: state_chg to LU_COMPL_VLR_S_WAIT_SUB_PRES
DVLR lu_compl_vlr_fsm(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){LU_COMPL_VLR_S_WAIT_SUB_PRES}: Received Event LU_COMPL_VLR_E_SUB_PRES_COMPL
- sending LU Accept for IMSI-901700000004620_MSISDN-46071
DREF VLR subscr IMSI-901700000004620_MSISDN-46071 usage increases to: 3
DVLR lu_compl_vlr_fsm(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){LU_COMPL_VLR_S_WAIT_SUB_PRES}: state_chg to LU_COMPL_VLR_S_DONE
DVLR vlr_lu_fsm(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){VLR_ULA_S_WAIT_LU_COMPL}: Received Event VLR_ULA_E_LU_COMPL_SUCCESS
DVLR lu_compl_vlr_fsm(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){LU_COMPL_VLR_S_DONE}: Terminating (cause = OSMO_FSM_TERM_PARENT)
DVLR lu_compl_vlr_fsm(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){LU_COMPL_VLR_S_DONE}: Removing from parent vlr_lu_fsm(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU)
DVLR lu_compl_vlr_fsm(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){LU_COMPL_VLR_S_DONE}: Freeing instance
DVLR lu_compl_vlr_fsm(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){LU_COMPL_VLR_S_DONE}: Deallocated
DVLR vlr_lu_fsm(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){VLR_ULA_S_WAIT_LU_COMPL}: state_chg to VLR_ULA_S_DONE
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){RAN_CONN_S_AUTH_CIPH}: Received Event RAN_CONN_E_ACCEPTED
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){RAN_CONN_S_AUTH_CIPH}: state_chg to RAN_CONN_S_ACCEPTED
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){RAN_CONN_S_ACCEPTED}: Received Event RAN_CONN_E_UNUSED
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){RAN_CONN_S_ACCEPTED}: state_chg to RAN_CONN_S_RELEASING
DREF IMSI-901700000004620_MSISDN-46071: MSC conn use + release == 1 (0x100: release)
DREF VLR subscr IMSI-901700000004620_MSISDN-46071 usage increases to: 4
DREF VLR subscr IMSI-901700000004620_MSISDN-46071 usage decreases to: 3
- BSSAP Clear --GERAN-A--> MS
DREF VLR subscr IMSI-901700000004620_MSISDN-46071 usage decreases to: 2
<-- GSUP rx OSMO_GSUP_MSGT_UPDATE_LOCATION_RESULT: vlr_gsupc_read_cb() returns 0
  bssap_clear_sent == 1
- LU was successful, and the conn has already been closed
  lu_result_sent == 1
- BSS sends BSSMAP Clear Complete
DREF IMSI-901700000004620_MSISDN-46071: MSC conn use - release == 0 (0x0: )
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){RAN_CONN_S_RELEASING}: Received Event RAN_CONN_E_UNUSED
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){RAN_CONN_S_RELEASING}: state_chg to RAN_CONN_S_RELEASED
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){RAN_CONN_S_RELEASED}: Terminating (cause = OSMO_FSM_TERM_REGULAR)
DVLR vlr_lu_fsm(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){VLR_ULA_S_DONE}: Terminating (cause = OSMO_FSM_TERM_PARENT)
DVLR vlr_lu_fsm(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){VLR_ULA_S_DONE}: Removing from parent RAN_conn(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU)
DVLR vlr_lu_fsm(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){VLR_ULA_S_DONE}: fsm_lu_cleanup called with cause OSMO_FSM_TERM_PARENT
DVLR vlr_lu_fsm(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){VLR_ULA_S_DONE}: Freeing instance
DVLR vlr_lu_fsm(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){VLR_ULA_S_DONE}: Deallocated
DRLL IMSI-901700000004620_MSISDN-46071: Freeing RAN connection
DREF VLR subscr IMSI-901700000004620_MSISDN-46071 usage decreases to: 1
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){RAN_CONN_S_RELEASED}: Freeing instance
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_LU){RAN_CONN_S_RELEASED}: Deallocated
  llist_count(&net->ran_conns) == 0
---
- an SMS is sent, MS is paged
DREF VLR subscr IMSI-901700000004620_MSISDN-46071 usage increases to: 2
  llist_count(&vsub->cs.requests) == 0
DREF VLR subscr IMSI-901700000004620_MSISDN-46071 usage increases to: 3
DCC (ti 00 sub IMSI-901700000004620_MSISDN-46071 callref 40000003) New transaction
DREF VLR subscr IMSI-901700000004620_MSISDN-46071 usage increases to: 4
DMM Subscriber IMSI-901700000004620_MSISDN-46071 not paged yet, start paging.
  GERAN-A sends out paging request to IMSI 901700000004620, TMSI 0xffffffff, LAC 23
  strcmp(paging_expecting_imsi, imsi) == 0
DREF VLR subscr IMSI-901700000004620_MSISDN-46071 usage increases to: 5
  llist_count(&vsub->cs.requests) == 1
DREF VLR subscr IMSI-901700000004620_MSISDN-46071 usage decreases to: 4
  paging_sent == 1
  paging_stopped == 0
- MS replies with Paging Response, we deliver the SMS
  MSC <--GERAN-A-- MS: GSM48_MT_RR_PAG_RESP
  new conn
DMM RAN_conn{RAN_CONN_S_NEW}: Allocated
DREF unknown: MSC conn use + compl_l3 == 1 (0x1: compl_l3)
DRLL Dispatching 04.08 message GSM48_MT_RR_PAG_RESP (0x6:0x27)
DRR PAGING RESPONSE: MI(IMSI)=901700000004620
DMM RAN_conn(GERAN-A-0_unknown_PAGING_RESP){RAN_CONN_S_NEW}: Updated ID
DVLR Process_Access_Request_VLR(GERAN-A-0_unknown_PAGING_RESP){PR_ARQ_S_INIT}: Allocated
DVLR Process_Access_Request_VLR(GERAN-A-0_unknown_PAGING_RESP){PR_ARQ_S_INIT}: is child of RAN_conn(GERAN-A-0_unknown_PAGING_RESP)
DVLR Process_Access_Request_VLR(GERAN-A-0_unknown_PAGING_RESP){PR_ARQ_S_INIT}: rev=GSM net=GERAN (no Auth)
DVLR Process_Access_Request_VLR(GERAN-A-0_unknown_PAGING_RESP){PR_ARQ_S_INIT}: Received Event PR_ARQ_E_START
DREF VLR subscr IMSI-901700000004620_MSISDN-46071 usage increases to: 5
DREF VLR subscr IMSI-901700000004620_MSISDN-46071 usage increases to: 6
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_PAGING_RESP){RAN_CONN_S_NEW}: Updated ID
DVLR Process_Access_Request_VLR(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_PAGING_RESP){PR_ARQ_S_INIT}: proc_arq_vlr_fn_post_imsi()
DVLR Process_Access_Request_VLR(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_PAGING_RESP){PR_ARQ_S_INIT}: _proc_arq_vlr_node2()
DVLR Process_Access_Request_VLR(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_PAGING_RESP){PR_ARQ_S_INIT}: _proc_arq_vlr_node2_post_ciph()
DVLR Process_Access_Request_VLR(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_PAGING_RESP){PR_ARQ_S_INIT}: _proc_arq_vlr_node2_post_vlr()
DVLR Process_Access_Request_VLR(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_PAGING_RESP){PR_ARQ_S_INIT}: _proc_arq_vlr_post_pres()
DVLR Process_Access_Request_VLR(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_PAGING_RESP){PR_ARQ_S_INIT}: _proc_arq_vlr_post_trace()
DVLR Process_Access_Request_VLR(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_PAGING_RESP){PR_ARQ_S_INIT}: _proc_arq_vlr_post_imei()
DVLR Process_Access_Request_VLR(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_PAGING_RESP){PR_ARQ_S_INIT}: proc_arq_fsm_done(PASSED)
DVLR Process_Access_Request_VLR(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_PAGING_RESP){PR_ARQ_S_INIT}: state_chg to PR_ARQ_S_DONE
DVLR Process_Access_Request_VLR(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_PAGING_RESP){PR_ARQ_S_DONE}: Process Access Request result: PASSED
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_PAGING_RESP){RAN_CONN_S_NEW}: Received Event RAN_CONN_E_ACCEPTED
DPAG Paging success for IMSI-901700000004620_MSISDN-46071 (event=0)
DPAG Calling paging cbfn.
DREF IMSI-901700000004620_MSISDN-46071: MSC conn use + trans_sms == 2 (0x21: compl_l3,trans_sms)
DMSC msc_tx 91 bytes to IMSI-901700000004620_MSISDN-46071 via GERAN-A
- DTAP --GERAN-A--> MS: SMS:0x01: 09015801000791447758100650004c0005806470f1000007101000000000445079da1e1ee7416937485e9ea7c965373d1d6683c270383b3d0ed3d36ff71c949e83c22072799e9687c5ec32a81d96afcbf4b4fb0c7ac3e9e9b7db05
- DTAP matches expected message
DREF VLR subscr IMSI-901700000004620_MSISDN-46071 usage decreases to: 5
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_PAGING_RESP){RAN_CONN_S_NEW}: state_chg to RAN_CONN_S_ACCEPTED
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_PAGING_RESP){RAN_CONN_S_ACCEPTED}: ran_conn_fsm_has_active_transactions: connection still has active transaction: SMS
DREF VLR subscr IMSI-901700000004620_MSISDN-46071 usage decreases to: 4
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_PAGING_RESP){RAN_CONN_S_ACCEPTED}: Received Event RAN_CONN_E_COMPLETE_LAYER_3
DREF IMSI-901700000004620_MSISDN-46071: MSC conn use - compl_l3 == 1 (0x20: trans_sms)
  dtap_tx_confirmed == 1
  paging_stopped == 1
- conn is still open to wait for SMS ack dance
  llist_count(&net->ran_conns) == 1
---
- MS sends another erratic Paging Response which is dropped silently
  MSC <--GERAN-A-- MS: GSM48_MT_RR_PAG_RESP
DREF IMSI-901700000004620_MSISDN-46071: MSC conn use + dtap == 2 (0x22: dtap,trans_sms)
DRLL Dispatching 04.08 message GSM48_MT_RR_PAG_RESP (0x6:0x27)
DMM Ignoring Paging Response, conn already established
DREF IMSI-901700000004620_MSISDN-46071: MSC conn use - dtap == 1 (0x20: trans_sms)
- MS replies with CP-ACK for received SMS
  MSC <--GERAN-A-- MS: SMS:0x04
DREF IMSI-901700000004620_MSISDN-46071: MSC conn use + dtap == 2 (0x22: dtap,trans_sms)
DRLL Dispatching 04.08 message SMS:0x04 (0x9:0x4)
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_PAGING_RESP){RAN_CONN_S_ACCEPTED}: Received Event RAN_CONN_E_COMMUNICATING
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_PAGING_RESP){RAN_CONN_S_ACCEPTED}: state_chg to RAN_CONN_S_COMMUNICATING
DREF IMSI-901700000004620_MSISDN-46071: MSC conn use - dtap == 1 (0x20: trans_sms)
  llist_count(&net->ran_conns) == 1
- MS also sends RP-ACK, MSC in turn sends CP-ACK for that
  MSC <--GERAN-A-- MS: SMS:0x01
DREF IMSI-901700000004620_MSISDN-46071: MSC conn use + dtap == 2 (0x22: dtap,trans_sms)
DRLL Dispatching 04.08 message SMS:0x01 (0x9:0x1)
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_PAGING_RESP){RAN_CONN_S_COMMUNICATING}: Received Event RAN_CONN_E_COMMUNICATING
DMSC msc_tx 2 bytes to IMSI-901700000004620_MSISDN-46071 via GERAN-A
- DTAP --GERAN-A--> MS: SMS:0x04: 0904
- DTAP matches expected message
DREF VLR subscr IMSI-901700000004620_MSISDN-46071 usage decreases to: 3
DREF VLR subscr IMSI-901700000004620_MSISDN-46071 usage decreases to: 2
DREF IMSI-901700000004620_MSISDN-46071: MSC conn use - trans_sms == 1 (0x2: dtap)
DREF IMSI-901700000004620_MSISDN-46071: MSC conn use - dtap == 0 (0x0: )
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_PAGING_RESP){RAN_CONN_S_COMMUNICATING}: Received Event RAN_CONN_E_UNUSED
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_PAGING_RESP){RAN_CONN_S_COMMUNICATING}: state_chg to RAN_CONN_S_RELEASING
DREF IMSI-901700000004620_MSISDN-46071: MSC conn use + release == 1 (0x100: release)
DREF VLR subscr IMSI-901700000004620_MSISDN-46071 usage increases to: 3
DREF VLR subscr IMSI-901700000004620_MSISDN-46071 usage decreases to: 2
- BSSAP Clear --GERAN-A--> MS
  dtap_tx_confirmed == 1
  bssap_clear_sent == 1
- BSS sends BSSMAP Clear Complete
DREF IMSI-901700000004620_MSISDN-46071: MSC conn use - release == 0 (0x0: )
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_PAGING_RESP){RAN_CONN_S_RELEASING}: Received Event RAN_CONN_E_UNUSED
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_PAGING_RESP){RAN_CONN_S_RELEASING}: state_chg to RAN_CONN_S_RELEASED
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_PAGING_RESP){RAN_CONN_S_RELEASED}: Terminating (cause = OSMO_FSM_TERM_REGULAR)
DVLR Process_Access_Request_VLR(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_PAGING_RESP){PR_ARQ_S_DONE}: Terminating (cause = OSMO_FSM_TERM_PARENT)
DVLR Process_Access_Request_VLR(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_PAGING_RESP){PR_ARQ_S_DONE}: Removing from parent RAN_conn(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_PAGING_RESP)
DVLR Process_Access_Request_VLR(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_PAGING_RESP){PR_ARQ_S_DONE}: Freeing instance
DVLR Process_Access_Request_VLR(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_PAGING_RESP){PR_ARQ_S_DONE}: Deallocated
DRLL IMSI-901700000004620_MSISDN-46071: Freeing RAN connection
DREF VLR subscr IMSI-901700000004620_MSISDN-46071 usage decreases to: 1
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_PAGING_RESP){RAN_CONN_S_RELEASED}: Freeing instance
DMM RAN_conn(GERAN-A-0_IMSI-901700000004620_MSISDN-46071_PAGING_RESP){RAN_CONN_S_RELEASED}: Deallocated
- SMS is done
  llist_count(&net->ran_conns) == 0
DREF freeing VLR subscr IMSI-901700000004620_MSISDN-46071
===== test_reject_paging_resp_during_paging_resp: SUCCESS

full talloc report on 'msgb' (total      0 bytes in   1 blocks)
talloc_total_blocks(tall_bsc_ctx) == 13

full talloc report on 'msgb' (total      0 bytes in   1 blocks)
talloc_total_blocks(tall_bsc_ctx) == 13

